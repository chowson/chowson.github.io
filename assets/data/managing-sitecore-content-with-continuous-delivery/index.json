{"hash":"1c8e9faebecda25e3acf6bcb04e4b97b55ed7066","data":{"post":{"title":"Managing Sitecore Content with Continuous Delivery","description":"Simple Sitecore Content Feature Toggle for Continuous Delivery","date":"July 18, 2017","timeToRead":2,"content":"<p>The standard way in Sitecore to prevent content being seen by users before\nit's ready is to use publishing restrictions. Marking the content as unpublishable\nensures any publishes don't push the content to the web database.</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 996 286' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-be6bec7557627f87d65b4df821f5f567'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-be6bec7557627f87d65b4df821f5f567)' width='996' height='286' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAASAEADASIAAhEBAxEB/8QAGwAAAgIDAQAAAAAAAAAAAAAAAAgBAgMEBQb/xAA1EAABAwICBQoEBwAAAAAAAAABAAIDBREEIQYSExiSBwgjMTJBUVVh0RQWkcEiQlNxcqGx/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhEDEQA/AM%2bN5DKpTcDPiMZUqHscLC6WV2weTqtFyexnkOpcTR3km%2bbop56PWqa5mHc2OToJYs3DWGWrnl3prpsOHym7Lsd1jUuD/f2WuGYWAubFhHMsc9m0Nv8ARAuUnNvrriDFWaUweokd9gqbtukPnlJ4JPZMi90Iv0E2XgVujBxHOzs/VAsO7bpD55SeCT2Ru26Q%2beUngk9kz/wcXgfqrR4aJjbagdne7s0CvbtukPnlJ4JPZXj5uWkTAQK1Rjc3/FFIe63h6podjF%2bkzhCgwxAXEbL/AMQgxFrdsDYXuM7LkYkDbS5fmP8AqEIKzAazhYWXoWdkfshCCUIQgEHqKEIP/9k=' /%3e%3c/svg%3e\" width=\"996\" alt=\"Item publishing restrictions\" data-srcset=\"/assets/static/item-publishing-restrictions.82a2fbd.0e486e04eae23435166a236675c32d13.jpg 480w, /assets/static/item-publishing-restrictions.f6ff8a4.0e486e04eae23435166a236675c32d13.jpg 996w\" data-sizes=\"(max-width: 996px) 100vw, 996px\" data-src=\"/assets/static/item-publishing-restrictions.f6ff8a4.0e486e04eae23435166a236675c32d13.jpg\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/item-publishing-restrictions.f6ff8a4.0e486e04eae23435166a236675c32d13.jpg\" width=\"996\" alt=\"Item publishing restrictions\"></noscript></p>\n<p>Whilst developing a new area of the site, continuous delivery will deploy partially\ncompleted pages. To ensure the new content is hidden from users, it is marked\nas  unpublishable. The problem with this is the new content needs to be visible on test environments\nand each deployment to the test environment resets the item to unpublishable.</p>\n<p>Having to mark the items as publishable and publish them on the test environments breaks\nthe continuous delivery deployment pipeline because it introduces a manual step. Continuous\ndelivery aims to have a fully automated process that you can deploy and release any version\nof the software to any environment.</p>\n<p>The following solution allows new content to be deployed to both master and web\ndatabases with continuous delivery but prevents public users from seeing it.</p>\n<p>To achieve this, a <em>Controller Rendering</em> is added to a new page and returns\n404 response unless some particular criteria is matched. The example provided checks for\nthe existence of a known querystring:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">class</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">SitecoreContentFeatureToggleController</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">Controller</span>\n<span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">private</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">const</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">string</span><span style=\"color: #D8DEE9FF\"> ToggleOverrideQueryStringKey </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">SomethingNotEasyToGuess</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">\t</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">ActionResult</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">Index</span><span style=\"color: #ECEFF4\">()</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">if</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #88C0D0\">ToggleOverridePresent</span><span style=\"color: #ECEFF4\">())</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #81A1C1\">return</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">new</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">EmptyResult</span><span style=\"color: #ECEFF4\">()</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">}</span>\n\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">return</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">HttpNotFound</span><span style=\"color: #ECEFF4\">()</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">}</span>\n\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">private</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">bool</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">ToggleOverridePresent</span><span style=\"color: #ECEFF4\">()</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">string</span><span style=\"color: #D8DEE9FF\"> enableToggleOverride </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">Request</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">QueryString</span><span style=\"color: #ECEFF4\">[</span><span style=\"color: #D8DEE9\">ToggleOverrideQueryStringKey</span><span style=\"color: #ECEFF4\">]</span><span style=\"color: #81A1C1\">;</span>\n\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">return</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">!</span><span style=\"color: #D8DEE9\">string</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">IsNullOrEmpty</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">enableToggleOverride</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">&&</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">enableToggleOverride</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">Equals</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">true</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #ECEFF4\">}</span></code></pre>\n<p>Other simple checks could be implemented instead of checking the querystring:</p>\n<ul>\n<li>Existence of a particular request header</li>\n<li>Existence of a particular cookie (with particular value)</li>\n<li>Request IP address whitelist</li>\n</ul>\n<p>When making the <em>Controller Rendering</em>, it is important to ensure the rendering's caching\nfields are all unchecked. If it is marked as cacheable then the check is only applied to the first\nvisitor rather than to each request.</p>\n<p>As the title suggests, this is a simple feature toggle and does not prevent\nother parts of the site from linking to the new content. For example, using this\nfor news articles would not prevent the new article being picked up on the news\nlanding page.</p>\n<p>To use this approach, simply create the controller rendering and add it to the\ncontent item instead of marking the item as unpublishable.</p>\n<h3 id=\"benefits-of-approach\"><a href=\"#benefits-of-approach\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Benefits of Approach</h3>\n<ul>\n<li>The deployment process for each environment is the same.</li>\n<li>The test team don't need to make the new content items publishable and then publish them\non each deployment to the test environment.</li>\n<li>Each deployment to the UAT environment won't require the unpublishable flag removing and\nthe content being published.</li>\n<li>If the client wants to see the new features on the live site, then they can.</li>\n<li>Public users receive a 404 response when they hit the URL.</li>\n</ul>\n<h3 id=\"when-to-use-this\"><a href=\"#when-to-use-this\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>When to use this?</h3>\n<ul>\n<li>When the new content is isolated - e.g. Developing a new homepage - publishing the item to a URL with the feature toggle rendering will allow authorised people to see the new page on the without the public being able to see it.</li>\n</ul>\n<h3 id=\"when-not-to-use-it\"><a href=\"#when-not-to-use-it\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>When not to use it?</h3>\n<ul>\n<li>Any new page which other pages have been set up to link to.</li>\n</ul>\n","tags":[{"title":"sitecore","path":"/tag/sitecore/"}],"references":[],"path":"/managing-sitecore-content-with-continuous-delivery/"}},"context":{}}