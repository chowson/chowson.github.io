{"hash":"ac88158e9736ebb7f8a56d6784e5affcc0830bca","data":{"post":{"title":"Sitecore Item Paths in SQL Queries","description":"Sitecore Item Paths in SQL Queries","date":"September 3, 2016","timeToRead":1,"content":"<p>Developing or debugging Sitecore applications can quite often lead\nto executing SQL queries to try and work out how something works or\nwhere the issue lies.</p>\n<p>One piece of information that cannot be easily accessed in an\nSQL query is the hierarchy of items because the item path isn't saved\nas a field value within the database. Item hierarchy is instead stored\nby each row in the <em>Items</em> table storing the ID of its parent\nin the <em>ParentID</em> column.</p>\n<p>Running the following SQL statement will create a\nview which is a copy of the <em>Items</em> table but with an additional\ncolumn defining the item's full path:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #D8DEE9FF\">CREATE VIEW [dbo].[ItemsPath]</span>\n<span style=\"color: #81A1C1\">AS</span>\n<span style=\"color: #D8DEE9FF\">    WITH ItemsTable (ItemPath, ID, Name, TemplateID, MasterID, ParentID, Created, Updated)</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">AS</span>\n<span style=\"color: #D8DEE9FF\">    (</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">SELECT</span><span style=\"color: #D8DEE9FF\"> CAST(</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">/</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">+</span><span style=\"color: #D8DEE9FF\"> base.Name </span><span style=\"color: #81A1C1\">AS</span><span style=\"color: #D8DEE9FF\"> nvarchar(MAX)) </span><span style=\"color: #81A1C1\">as</span><span style=\"color: #D8DEE9FF\"> ItemPath,</span>\n<span style=\"color: #D8DEE9FF\">            base.ID, base.Name, base.TemplateID, base.MasterID, base.ParentID, base.Created, base.Updated</span>\n<span style=\"color: #D8DEE9FF\">\t\t\t</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">FROM</span><span style=\"color: #D8DEE9FF\"> Items </span><span style=\"color: #81A1C1\">as</span><span style=\"color: #D8DEE9FF\"> base</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">WHERE</span><span style=\"color: #D8DEE9FF\"> base.ID </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">11111111-1111-1111-1111-111111111111</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #D8DEE9FF\">\t</span>\n\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">UNION ALL</span>\n<span style=\"color: #D8DEE9FF\">\t</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">SELECT</span><span style=\"color: #D8DEE9FF\"> CAST(ItemPath </span><span style=\"color: #81A1C1\">+</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">/</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">+</span><span style=\"color: #D8DEE9FF\"> child.Name </span><span style=\"color: #81A1C1\">AS</span><span style=\"color: #D8DEE9FF\"> nvarchar(MAX)),</span>\n<span style=\"color: #D8DEE9FF\">            child.ID, child.Name, child.TemplateID, child.MasterID, child.ParentID, child.Created, child.Updated</span>\n<span style=\"color: #D8DEE9FF\">\t\t\t</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">FROM</span><span style=\"color: #D8DEE9FF\"> ItemsTable </span><span style=\"color: #81A1C1\">as</span><span style=\"color: #D8DEE9FF\"> parent </span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">INNER JOIN</span><span style=\"color: #D8DEE9FF\"> Items </span><span style=\"color: #81A1C1\">as</span><span style=\"color: #D8DEE9FF\"> child </span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #81A1C1\">ON</span><span style=\"color: #D8DEE9FF\"> child.ParentID </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> parent.ID </span>\n<span style=\"color: #D8DEE9FF\">    )\t</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">SELECT</span><span style=\"color: #D8DEE9FF\"> ItemPath, ID, Name, TemplateID, MasterID, ParentID, Created, Updated</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">FROM</span><span style=\"color: #D8DEE9FF\"> ItemsTable</span>\n<span style=\"color: #81A1C1\">GO</span></code></pre>\n<p>Running the query below will return the following result:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #81A1C1\">SELECT</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">*</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">FROM</span><span style=\"color: #D8DEE9FF\"> ItemsPath</span></code></pre>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 1323 317' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-1c248fb7a9e12bec968e5837803d2d42'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-1c248fb7a9e12bec968e5837803d2d42)' width='1323' height='317' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAPAEADASIAAhEBAxEB/8QAGQABAQADAQAAAAAAAAAAAAAABAMAAgUI/8QAKBAAAgEDAwMCBwAAAAAAAAAAAQIDAAQREiExE1GhYYEFFDJBsbLB/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAwDAQACEQMRAD8A9CvAD8U09fpo2khSiEKdOdsjbNXvnks5VRH6gZdWXUZ59MCjX4Zrn2H61l6xcWrMN%2bljzVqQpJWki1MVVjA7YA5IJ3HahLezJGBrU4HJAJpMZIij7GCT%2b1zSDoyOMZqKZHdS/OQjUCJAmoY258VcOyAqJTgE/UAT5FFUML21zzpjqch1FiPuc0Dp5nRYWRwWKNnYYO/bipm5lU6gwywUkEbewqca5toR6MPNbMp29FX8UH//2Q==' /%3e%3c/svg%3e\" width=\"1323\" alt=\"Item paths in SQL\" data-srcset=\"/assets/static/ItemPaths.82a2fbd.a8f808e245736226822bc42137f818d9.jpg 480w, /assets/static/ItemPaths.76e8edd.a8f808e245736226822bc42137f818d9.jpg 1323w\" data-sizes=\"(max-width: 1323px) 100vw, 1323px\" data-src=\"/assets/static/ItemPaths.76e8edd.a8f808e245736226822bc42137f818d9.jpg\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/ItemPaths.76e8edd.a8f808e245736226822bc42137f818d9.jpg\" width=\"1323\" alt=\"Item paths in SQL\"></noscript></p>\n<p>Once the view is created, queries can be run like the following:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #4C566A\">--Returns all descendants of the /sitecore/template item</span>\n\n<span style=\"color: #81A1C1\">SELECT</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">*</span><span style=\"color: #D8DEE9FF\"> </span>\n<span style=\"color: #81A1C1\">FROM</span><span style=\"color: #D8DEE9FF\"> ItemsPath</span>\n<span style=\"color: #81A1C1\">WHERE</span><span style=\"color: #D8DEE9FF\"> ItemPath </span><span style=\"color: #81A1C1\">LIKE</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">/sitecore/templates%</span><span style=\"color: #ECEFF4\">'</span>\n\n<span style=\"color: #4C566A\">--Returns all rows in the WorkflowHistory table for all </span>\n<span style=\"color: #4C566A\">--descendants of the news item (/sitecore/content/Home/News)</span>\n\n<span style=\"color: #81A1C1\">SELECT</span><span style=\"color: #D8DEE9FF\">\t WorkflowHistory.</span><span style=\"color: #81A1C1\">*</span>\n<span style=\"color: #81A1C1\">FROM</span><span style=\"color: #D8DEE9FF\"> WorkflowHistory</span>\n<span style=\"color: #81A1C1\">JOIN</span><span style=\"color: #D8DEE9FF\"> dbo.ItemsPath </span><span style=\"color: #81A1C1\">ON</span><span style=\"color: #D8DEE9FF\"> ItemsPath.ID </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> WorkflowHistory.ItemID</span>\n<span style=\"color: #81A1C1\">WHERE</span><span style=\"color: #D8DEE9FF\"> ItemPath </span><span style=\"color: #81A1C1\">LIKE</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">/sitecore/content/Home/News%</span><span style=\"color: #ECEFF4\">'</span></code></pre>\n","tags":[{"title":"sitecore","path":"/tag/sitecore/"},{"title":"debugging","path":"/tag/debugging/"},{"title":"sql","path":"/tag/sql/"}],"references":[],"path":"/sitecore-item-paths-in-sql-queries/"}},"context":{}}