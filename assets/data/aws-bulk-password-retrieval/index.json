{"hash":"a5f4f482c6a4a22d5bf30a578e028699128c226a","data":{"post":{"title":"AWS: Bulk EC2 Password retrieval with Powershell","description":"Using Powershell to describe all EC2 instances including administrator password","date":"November 12, 2015","timeToRead":1,"content":"<p>When using EC2, I find it a laborious process to log in to the AWS console and\nretrieve all of the information required to remote desktop to an instance and\nthen even more clicks to retrieve the administrator password. If you have created\nN instances using something like CloudFormation, then this time increases by N times\ndepending on the number of instances you want to access.</p>\n<p>The script at the end of this article retrieves all of the common information you\nneed about your EC2 instances with just one command as well as decrypting all of\nthe passwords saving a lot of time and effort. All that is required to run it\nis the <a href=\"https://aws.amazon.com/powershell/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">AWS Tools for Powershell</a> and the PEM\nfile the instances were assigned to so that the password can be decrypted.</p>\n<p>Here is an example of the output you will get:</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 669 121' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-91795779f7b7663823bb32371c669f0e'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-91795779f7b7663823bb32371c669f0e)' width='669' height='121' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAMAEADASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAQCAwUH/8QAKxAAAgEDAgMGBwAAAAAAAAAAAQIDAAQREiETIjEFFEFRYXEVMnKBodHh/8QAFwEAAwEAAAAAAAAAAAAAAAAAAAIFAf/EABsRAAMAAgMAAAAAAAAAAAAAAAABEQIhEjFh/9oADAMBAAIRAxEAPwDibW0sMgzGht3fAYrGX2x67dR6Ve8GllGhSGYKAY4ep%2b/vSEvalzKqh2XCsWHL4nH6FSk7Wun06ivKwcbeIq%2b8E%2b0SaXXCQxrEZgyqSDyRR59eh8vOi2ghujJweKUXG5SNSCSfMikbm7luVRZSMJ0wKnY381kX4BUa8ZyM9KbjFoy7NDubtIySRKF2ZCiRaj77/is2VpIJmSSOIOuxBRT/ACmPjN3qDalBA0/L4UlPM08zyvjU5ycUL0GSedmbOmIfTGAKBOwxyxHAxvGDVVFNBaf/2Q==' /%3e%3c/svg%3e\" width=\"669\" alt=\"Describe EC2 instances\" data-srcset=\"/assets/static/describe-ec2-instances.58cb598.2bd96a190fc2cce9a112b8c448d42071.jpg 669w\" data-sizes=\"(max-width: 669px) 100vw, 669px\" data-src=\"/assets/static/describe-ec2-instances.58cb598.2bd96a190fc2cce9a112b8c448d42071.jpg\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/describe-ec2-instances.58cb598.2bd96a190fc2cce9a112b8c448d42071.jpg\" width=\"669\" alt=\"Describe EC2 instances\"></noscript></p>\n<p>And the script to generate it:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #81A1C1\">Param</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">(</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #81A1C1\">[Parameter</span><span style=\"color: #8FBCBB\">(</span><span style=\"color: #81A1C1\">Mandatory</span><span style=\"color: #8FBCBB\">=</span><span style=\"color: #D8DEE9\">$true</span><span style=\"color: #8FBCBB\">)</span><span style=\"color: #81A1C1\">]</span><span style=\"color: #8FBCBB\">[string]</span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">PemFilePath</span><span style=\"color: #81A1C1\">,</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #81A1C1\">[Parameter</span><span style=\"color: #8FBCBB\">(</span><span style=\"color: #81A1C1\">Mandatory</span><span style=\"color: #8FBCBB\">=</span><span style=\"color: #D8DEE9\">$true</span><span style=\"color: #8FBCBB\">)</span><span style=\"color: #81A1C1\">]</span><span style=\"color: #8FBCBB\">[string]</span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">AwsRegion</span><span style=\"color: #81A1C1\">,</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #8FBCBB\">[string]</span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">AwsAccessKey</span><span style=\"color: #81A1C1\">,</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #8FBCBB\">[string]</span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">AwsSecretyKey</span><span style=\"color: #81A1C1\">,</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #8FBCBB\">[string]</span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">ProfileName</span>\n<span style=\"color: #81A1C1\">)</span>\n\n<span style=\"color: #81A1C1\">Function</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">Describe-Instance</span>\n<span style=\"color: #D8DEE9FF\">{</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #81A1C1\">Param([Parameter</span><span style=\"color: #8FBCBB\">(</span><span style=\"color: #81A1C1\">ValueFromPipeline</span><span style=\"color: #8FBCBB\">=</span><span style=\"color: #D8DEE9\">$true</span><span style=\"color: #8FBCBB\">)</span><span style=\"color: #81A1C1\">]</span><span style=\"color: #8FBCBB\">[Amazon.EC</span><span style=\"color: #D8DEE9FF\">2</span><span style=\"color: #8FBCBB\">.Model.Instance]</span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">instance</span><span style=\"color: #81A1C1\">)</span>\n\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #81A1C1\">Process</span>\n<span style=\"color: #D8DEE9FF\">  {</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">resolvedPemFilePath</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">Resolve-Path</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">PemFilePath</span>\n\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">try</span>\n<span style=\"color: #D8DEE9FF\">    {</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">password</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">Get-EC2PasswordData</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">InstanceId </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">instance</span><span style=\"color: #88C0D0\">.InstanceId</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">                                      </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">PemFile </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">resolvedPemFilePath</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">                                      </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">Region </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">AwsRegion</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">                                      </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">AccessKey </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">AwsAccessKey</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">                                      </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">SecretKey </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">AwsSecretyKey</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">                                      </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">ProfileName </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">ProfileName</span>\n<span style=\"color: #D8DEE9FF\">    }</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">catch</span><span style=\"color: #D8DEE9FF\"> { </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">password</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #A3BE8C\">\"ERROR\"</span><span style=\"color: #D8DEE9FF\"> }</span>\n\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">instanceInformation</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">New-Object</span><span style=\"color: #D8DEE9FF\"> PSObject</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #88C0D0\">Add-Member</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">InputObject </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">instanceInformation</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">MemberType NoteProperty </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">Name </span><span style=\"color: #A3BE8C\">\"Name\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">Value </span><span style=\"color: #81A1C1\">($</span><span style=\"color: #D8DEE9\">instance</span><span style=\"color: #88C0D0\">.Tags</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">|</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">?</span><span style=\"color: #D8DEE9FF\"> { </span><span style=\"color: #81A1C1\">$_</span><span style=\"color: #88C0D0\">.key</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">-eq</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #A3BE8C\">\"Name\"</span><span style=\"color: #D8DEE9FF\"> } </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">                   </span><span style=\"color: #81A1C1\">|</span><span style=\"color: #D8DEE9FF\"> Select </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">expand Value</span><span style=\"color: #81A1C1\">)</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #88C0D0\">Add-Member</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">InputObject </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">instanceInformation</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">MemberType NoteProperty </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">Name </span><span style=\"color: #A3BE8C\">\"Instance Id\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">Value </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">instance</span><span style=\"color: #88C0D0\">.InstanceId</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #88C0D0\">Add-Member</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">InputObject </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">instanceInformation</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">MemberType NoteProperty </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">Name </span><span style=\"color: #A3BE8C\">\"Private Ip Address\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">Value </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">instance</span><span style=\"color: #88C0D0\">.PrivateIpAddress</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #88C0D0\">Add-Member</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">InputObject </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">instanceInformation</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">MemberType NoteProperty </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">Name Password </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">Value </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">password</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #88C0D0\">Add-Member</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">InputObject </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">instanceInformation</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">MemberType NoteProperty </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">Name State </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">               </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">Value </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">instance</span><span style=\"color: #88C0D0\">.State.Name</span>\n\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">return</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">instanceInformation</span>\n<span style=\"color: #D8DEE9FF\">  }</span>\n<span style=\"color: #D8DEE9FF\">}</span>\n\n<span style=\"color: #88C0D0\">Get-EC2Instance</span><span style=\"color: #D8DEE9FF\">\t</span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">Region </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">awsRegion</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">AccessKey </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">awsAccessKey</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">SecretKey </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">awsSecretyKey</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">ProfileName </span><span style=\"color: #81A1C1\">$</span><span style=\"color: #D8DEE9\">ProfileName</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #81A1C1\">|</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">Select-Object</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">ExpandProperty instances </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #81A1C1\">|</span><span style=\"color: #D8DEE9FF\"> Describe</span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">Instance </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #81A1C1\">|</span><span style=\"color: #D8DEE9FF\"> Sort</span><span style=\"color: #81A1C1\">-</span><span style=\"color: #D8DEE9FF\">Object Name </span><span style=\"color: #81A1C1\">`</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #81A1C1\">|</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">Format-Table</span></code></pre>\n<p>To add in the public IP address of the instance, just duplicate an <em>Add-Member</em>\nentry and change the <em>Name</em> parameter and the <em>Value</em> parameter to <em>PublicIpAddress</em>.</p>\n","tags":[{"title":"aws","path":"/tag/aws/"}],"references":["http://docs.aws.amazon.com/powershell/latest/reference/Index.html|AWS Tools for Windows Powershell Cmdlet Reference"],"path":"/aws-bulk-password-retrieval/"}},"context":{}}