{"hash":"a40bfc3e54a18259212a3c45a29cc93e306df4eb","data":{"post":{"title":"Developers Guide to Sitecore 8.1 Device Detection","description":"Introduction to Device detection in Sitecore 8.1 and how to extend it","date":"March 9, 2016","timeToRead":3,"content":"<p>The release of Sitecore 8.1 includes new functionality for enabling device\ndetection. This post explains how developers can extend or customise the out\nof the box implementation.</p>\n<h3 id=\"activating-device-detection\"><a href=\"#activating-device-detection\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Activating Device Detection</h3>\n<p>Sitecore has chosen <a href=\"http://www.netbiscuits.com/device-detection/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Netbiscuits</a>\nas the provider for identifying devices and describing the capabilities they have. The\nservice requires a subscription through the <em>Sitecore App Center</em> which can be\nfound in the <em>Launch Pad</em> of Sitecore 8. In the UK, the monthly subscription\ncost is Â£119.21 for unlimited detections per month and until this is activated, the device\ndetection functionality described below is disabled.</p>\n<p>You can find more information for <a href=\"https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/set_up_device_detection\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">setting up device detection on the Sitecore documentation site</a>.</p>\n<h3 id=\"using-device-detection\"><a href=\"#using-device-detection\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Using Device Detection</h3>\n<p>You can read about <a href=\"https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/using_device_detection\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">using Device Detection</a> on the Sitecore documentation site which goes through all of the integration points that are offered out of the box. The following points\ndescribe how this default functionality can be extended.</p>\n<h4 id=\"creating-a-custom-provider\"><a href=\"#creating-a-custom-provider\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Creating a Custom Provider</h4>\n<p>If you already have device detection on your site using a different provider then you may\nwant to carry on using that provider. Sitecore documentation provides some useful developer information for\n<a href=\"https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/configure_sitecore_device_detection\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">configuring device detection</a> and as with most Sitecore functionality, you can patch the default configuration to plug in your own provider. This means that you can get all of the above functionality but using a different implementation to the default Netbiscuits provider that ships with Sitecore 8.1. The configuration section which will need replacing is:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #81A1C1\">&lt;configuration&gt;</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #81A1C1\">&lt;sitecore&gt;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">&lt;deviceDetectionManager</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">defaultProvider</span><span style=\"color: #D8DEE9FF\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">netbiscuits</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">patch</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #8FBCBB\">source</span><span style=\"color: #D8DEE9FF\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">Sitecore.CES.DeviceDetection.config</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #81A1C1\">&gt;</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #81A1C1\">&lt;providers&gt;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">&lt;clear/&gt;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">&lt;add</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">name</span><span style=\"color: #D8DEE9FF\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">netbiscuits</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">type</span><span style=\"color: #D8DEE9FF\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">Sitecore.CES.DeviceDetection.Netbiscuits.DeviceInformationProviderNetbiscuits, Sitecore.CES.DeviceDetection</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #81A1C1\">/&gt;</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #81A1C1\">&lt;/providers&gt;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">&lt;/deviceDetectionManager&gt;</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #81A1C1\">&lt;/sitecore&gt;</span>\n<span style=\"color: #81A1C1\">&lt;/configuration&gt;</span></code></pre>\n<p>Using a custom include file to replace the default provider for your own implementation will\nprovide you full control of the device detection functionality within Sitecore 8.1, for example:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #81A1C1\">&lt;configuration</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">xmlns</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #8FBCBB\">patch</span><span style=\"color: #D8DEE9FF\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">http://www.sitecore.net/xmlconfig/</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #81A1C1\">&gt;</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #81A1C1\">&lt;sitecore&gt;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">&lt;deviceDetectionManager</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">defaultProvider</span><span style=\"color: #D8DEE9FF\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">netbiscuits</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #81A1C1\">&gt;</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #81A1C1\">&lt;</span><span style=\"color: #8FBCBB\">patch</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #81A1C1\">attribute</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">name</span><span style=\"color: #D8DEE9FF\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">defaultProvider</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">value</span><span style=\"color: #D8DEE9FF\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">newProviderName</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">/&gt;</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #81A1C1\">&lt;providers&gt;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">&lt;add</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">patch</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #8FBCBB\">instead</span><span style=\"color: #D8DEE9FF\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">*[@name='netbiscuits']</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">name</span><span style=\"color: #D8DEE9FF\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">newProviderName</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">type</span><span style=\"color: #D8DEE9FF\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">YourNameSpace.CustomDeviceInformationProvider, YourAssembly</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">/&gt;</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #81A1C1\">&lt;/providers&gt;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">&lt;/deviceDetectionManager&gt;</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #81A1C1\">&lt;/sitecore&gt;</span>\n<span style=\"color: #81A1C1\">&lt;/configuration&gt;</span></code></pre>\n<p>The Sitecore documentation for the <a href=\"https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/api_reference_for_the_device_detection_service\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">device detection API</a>, along with the following skeleton class should be enough to get going with your own implementation of a device information provider:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">class</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">CustomDeviceInformationProvider</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">Sitecore</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #81A1C1\">CES</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #81A1C1\">DeviceDetection</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #81A1C1\">DeviceInformationProviderBase</span>\n<span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">private</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">readonly</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">ReaderWriterLockSlim</span><span style=\"color: #D8DEE9FF\"> _readerWriterLockSlim </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">new</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">ReaderWriterLockSlim</span><span style=\"color: #ECEFF4\">()</span><span style=\"color: #81A1C1\">;</span>\n\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">override</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">bool</span><span style=\"color: #D8DEE9FF\"> IsEnabled</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">get</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #ECEFF4\">          </span><span style=\"color: #4C566A\">// TODO:Implement method to determine if functionality is enabled</span>\n<span style=\"color: #D8DEE9FF\">\t\t</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #81A1C1\">return</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">CustomLogicToDetermineIsEnabled</span><span style=\"color: #ECEFF4\">()</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">\t</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">override</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">DeviceInformation</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">GetDeviceInformation</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #81A1C1\">string</span><span style=\"color: #D8DEE9FF\"> userAgent</span><span style=\"color: #ECEFF4\">)</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #D8DEE9\">Assert</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">ArgumentNotNull</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">userAgent</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">userAgent</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">return</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">base</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">GetDeviceInformation</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">userAgent</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">    </span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">protected</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">override</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">DeviceInformation</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">DoGetDeviceInformation</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #81A1C1\">string</span><span style=\"color: #D8DEE9FF\"> userAgent</span><span style=\"color: #ECEFF4\">)</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #D8DEE9\">Assert</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">ArgumentNotNull</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">userAgent</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">userAgent</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">        </span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">using</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #81A1C1\">new</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">ReadScope</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">_readerWriterLockSlim</span><span style=\"color: #ECEFF4\">))</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #ECEFF4\">            </span><span style=\"color: #4C566A\">// TODO: Implement functionality to fill in DeviceInformation from  supplier</span>\n<span style=\"color: #D8DEE9FF\">\t\t\t</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #81A1C1\">var</span><span style=\"color: #D8DEE9FF\"> deviceInformation </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">CustomLogicToGetDeviceInformation</span><span style=\"color: #ECEFF4\">()</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">            </span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #81A1C1\">return</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">deviceInformation</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #ECEFF4\">}</span></code></pre>\n<p>Calling the base class's implementation of <em>GetDeviceInformation</em> ensures that\nthe result is cached within the Sitecore <em>DeviceItemsCache</em> and therefore only\n1 lookup is required per user agent (until the cache is cleared).</p>\n<h4 id=\"sitecore-rules-engine-integration\"><a href=\"#sitecore-rules-engine-integration\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Sitecore Rules Engine Integration</h4>\n<p>One of the device detection integrations Sitecore provides is a set of rules for use with the Sitecore rules engine. The rules can be found under the item <code>/sitecore/system/Settings/Rules/Definitions/Elements/Device</code> and are described <a href=\"https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/rules_and_parameters_for_device_detection\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">on the Sitecore Documentation site</a>. There is also a guide on how to <a href=\"https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/create_custom_rules_for_sitecore_device_detection\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">create new custom rules</a>.</p>\n<h4 id=\"sitecore-device-items--device-detection\"><a href=\"#sitecore-device-items--device-detection\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Sitecore Device Items &#x26; Device Detection</h4>\n<p>Another integration point for these rules are on the Sitecore device items found under\n<code>/sitecore/layout/Devices/Default</code>. A new field, <em>Rule</em>, has been added so that Sitecore will switch the user to that device item if the given rule evaluates to true. For example, <em>Mobile</em> Sitecore device item could use the rule <em><code>Device type is equal to Smartphone</code></em> to activate it.</p>\n<p>The rule configured on the Device Item is analysed within the <em>HttpRequestBegin</em>\npipeline step <em>Sitecore.Pipelines.HttpRequest.DeviceResolver</em>. This eventually calls\nthrough into the method <code>Sitecore.Data.Items.DeviceItem.MatchesRule(HttpContext httpContext)</code> to analyse the set rule against the visitor's request device. This shouldn't need to be\ncustomised, but if you find yourself needing to override the default <em>DeviceResolver</em>\nthen bear this functionality in mind.</p>\n<h4 id=\"xdb-integration\"><a href=\"#xdb-integration\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>xDB Integration</h4>\n<p>xDB also has an integration with Device Detection where reports can be generated showing a\nbreakdown of visitors by device type and then further filtered down to show a report by\ndevice model. You can see an <a href=\"https://doc.sitecore.net/~/media/446AB72ED1504A38B133E8EBD43D41A1.ashx?la=en\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">example report</a> on the Sitecore documentation.</p>\n","tags":[{"title":"sitecore","path":"/tag/sitecore/"}],"references":["https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/set_up_device_detection|Sitecore Documentation - Set up Device Detection","https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/rules_and_parameters_for_device_detection|Sitecore Documentation - Device Detection Rules","https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/configure_sitecore_device_detection|Sitecore Documentation - Configuring Device Detection","https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/create_custom_rules_for_sitecore_device_detection|Sitecore Documentation - Creating Custom Rules","https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/api_reference_for_the_device_detection_service|Sitecore Documentation - Device Detection API","https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/using_device_detection|Sitecore Documentation - Using Device Detection"],"path":"/sitecore-8-1-device-detection/"}},"context":{}}