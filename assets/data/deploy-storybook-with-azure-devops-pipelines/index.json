{"hash":"0c9c7634f9cfa53dc34d0d32389c339688308ca7","data":{"post":{"title":"Deploy Storybook to an Azure storage static website with Azure Devops Pipelines","description":"A guide to deploying Storybook to an Azure Blob Storage static website with Azure Devops Pipelines","date":"July 12, 2020","timeToRead":2,"content":"<p>Storybook is a great front end development tool. It is also a good platform for team\ncollaboration, allowing designers and QA an early preview. This provides early feedback\nreducing the cycle time of the feature developed.</p>\n<p>Azure Storage static website hosting is a perfect choice as the hosting\nprovider. It is <a href=\"https://azure.microsoft.com/en-gb/pricing/details/storage/blobs/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">cheap</a>\nand quick to get started.</p>\n<p>This guide demonstrates how to configure a pipeline that publishes Storybook to a static\nwebsite hosted in Azure storage for each feature branch.</p>\n<div class=\"list--nopadding list--h2\">\n<ol>\n<li>\n<h2 id=\"setup-a-static-website-in-azure-storage\"><a href=\"#setup-a-static-website-in-azure-storage\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Setup a Static website in Azure Storage</h2>\n<p>There are a few different ways to achieve this. The <a href=\"https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blob-static-website-how-to\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">how to guide</a> from Microsoft Docs is the best place\nto getting your static website setup.</p>\n</li>\n<li>\n<h2 id=\"connect-azure-devops-to-azure\"><a href=\"#connect-azure-devops-to-azure\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Connect Azure Devops to Azure</h2>\n<p>Next, you'll need to connect your Azure Devops project to your Azure subscription. To do this,\na <a href=\"https://docs.microsoft.com/en-us/azure/devops/pipelines/library/connect-to-azure?view=azure-devops\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">service connection</a>\nwill need to be setup.</p>\n</li>\n<li>\n<h2 id=\"setup-the-pipeline\"><a href=\"#setup-the-pipeline\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Setup the pipeline</h2>\n<p>The best way to configure Azure Devops Pipelines is with code using YAML.\nThe pipeline is then part of your repository enabling version control. This\nprovides history and comments about how the pipeline evolved.</p>\n<div class=\"list--reset\">\n<p>The pipeline below performs the following steps:</p>\n<ol>\n<li>Restores &#x26; caches NPM packages to enhance performance</li>\n<li>Runs <code>npm ci</code> to restore NPM packages</li>\n<li>Runs <code>npm run build-storybook</code> to build Storybook</li>\n<li>Copies the static website to Azure storage with a folder prefix of\nthe current branch name (<code>$(Build.SourceBranchName</code>)</li>\n</ol>\n</div>\n</li>\n</ol>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #8FBCBB\">trigger</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #ECEFF4\">- </span><span style=\"color: #A3BE8C\">none</span>\n\n<span style=\"color: #8FBCBB\">pool</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #8FBCBB\">vmImage</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">ubuntu-latest</span><span style=\"color: #ECEFF4\">'</span>\n\n<span style=\"color: #8FBCBB\">variables</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #8FBCBB\">SrcFolder</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">src</span><span style=\"color: #ECEFF4\">'</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #8FBCBB\">StorageAccountName</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">StorageAccountName</span><span style=\"color: #ECEFF4\">'</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #8FBCBB\">npm_config_cache</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #A3BE8C\">$(Pipeline.Workspace)/.npm</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #8FBCBB\">FolderPrefix</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #A3BE8C\">$(Build.SourceBranchName)</span>\n\n<span style=\"color: #8FBCBB\">jobs</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #ECEFF4\">- </span><span style=\"color: #8FBCBB\">job</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #A3BE8C\">Publish_Storybook_to_Static_Site</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #8FBCBB\">steps</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">- </span><span style=\"color: #8FBCBB\">task</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #A3BE8C\">Cache@2</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #8FBCBB\">inputs</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #8FBCBB\">key</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">npm | \"$(Agent.OS)\" | $(SrcFolder)/package-lock.json</span><span style=\"color: #ECEFF4\">'</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #8FBCBB\">restoreKeys</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">|</span>\n<span style=\"color: #D8DEE9FF\">          </span><span style=\"color: #A3BE8C\">npm | \"$(Agent.OS)\"</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #8FBCBB\">path</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #A3BE8C\">$(npm_config_cache)</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #8FBCBB\">displayName</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #A3BE8C\">Cache npm</span>\n\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">- </span><span style=\"color: #8FBCBB\">task</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #A3BE8C\">Npm@1</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #8FBCBB\">inputs</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #8FBCBB\">command</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">custom</span><span style=\"color: #ECEFF4\">'</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #8FBCBB\">customCommand</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">ci</span><span style=\"color: #ECEFF4\">'</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #8FBCBB\">workingDir</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">$(SrcFolder)</span><span style=\"color: #ECEFF4\">'</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #8FBCBB\">displayName</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">npm ci</span><span style=\"color: #ECEFF4\">'</span>\n<span style=\"color: #D8DEE9FF\">      </span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">- </span><span style=\"color: #8FBCBB\">task</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #A3BE8C\">Npm@1</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #8FBCBB\">inputs</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #8FBCBB\">command</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">custom</span><span style=\"color: #ECEFF4\">'</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #8FBCBB\">workingDir</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">$(SrcFolder)</span><span style=\"color: #ECEFF4\">'</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #8FBCBB\">customCommand</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">run build-storybook</span><span style=\"color: #ECEFF4\">'</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #8FBCBB\">displayName</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">Build Storybook</span><span style=\"color: #ECEFF4\">'</span>\n\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #ECEFF4\">- </span><span style=\"color: #8FBCBB\">task</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #A3BE8C\">AzureFileCopy@3</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #8FBCBB\">displayName</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">AzureBlob File Copy</span><span style=\"color: #ECEFF4\">'</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #8FBCBB\">inputs</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #8FBCBB\">SourcePath</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">$(SrcFolder)/storybook-static</span><span style=\"color: #ECEFF4\">'</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #8FBCBB\">azureSubscription</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">ServiceConnection_Name</span><span style=\"color: #ECEFF4\">'</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #8FBCBB\">Destination</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #A3BE8C\">AzureBlob</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #8FBCBB\">storage</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #A3BE8C\">$(StorageAccountName)</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #8FBCBB\">ContainerName</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">$web</span><span style=\"color: #ECEFF4\">'</span>\n<span style=\"color: #D8DEE9FF\">      </span><span style=\"color: #8FBCBB\">BlobPrefix</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #A3BE8C\">$(FolderPrefix)</span></code></pre>\n</div>\n<p>  Once committed to the repository, log into Azure Devops and create\na new pipeline using the wizard. Select where your code is and then\npick the YAML file of your pipeline.</p>\n","tags":[{"title":"Azure","path":"/tag/Azure/"},{"title":"Devops","path":"/tag/Devops/"}],"references":["https://storybook.js.org/|Storybook","https://azure.microsoft.com/en-gb/services/devops/pipelines/|Azure Devops Pipelines","https://azure.microsoft.com/en-gb/pricing/details/storage/blobs/|Azure Storage Blobs Pricing"],"path":"/deploy-storybook-with-azure-devops-pipelines/"}},"context":{}}