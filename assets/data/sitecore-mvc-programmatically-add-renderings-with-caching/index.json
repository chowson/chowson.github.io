{"hash":"f54a26b6994b22fc740b582c54afcb6a230cac5b","data":{"post":{"title":"Programmatically Adding Sitecore MVC Renderings with Caching","description":"Sitecore helper method to add a rendering within a view with caching","date":"August 26, 2015","timeToRead":2,"content":"<p>Sitecore provides a suite of web controls for Web Forms development within the\n<em>Sitecore.Web.UI.WebControls</em> namespace and one of these controls is <em>Sublayout</em>.\nThis was used to programmatically add a Sitecore sublayout to the current sublayout.\nThis control inherits from <em>Sitecore.Web.UI.WebControls.WebControl</em> which contains\nall of the standard caching properties such as <em>Cacheable, VaryByData, VaryByQueryString</em>\netc. Example usage of the <em>Sublayout</em> control:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #81A1C1\">&lt;</span><span style=\"color: #D8DEE9FF\">sc</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #81A1C1\">Sublayout</span><span style=\"color: #D8DEE9FF\"> runat</span><span style=\"color: #81A1C1\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">server</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">Path</span><span style=\"color: #81A1C1\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">/layouts/Header.ascx</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">placeholder</span><span style=\"color: #81A1C1\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">content</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">Cacheable</span><span style=\"color: #81A1C1\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">True</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">VaryByData</span><span style=\"color: #81A1C1\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">True</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #81A1C1\">&gt;&lt;/</span><span style=\"color: #D8DEE9\">sc</span><span style=\"color: #D8DEE9FF\">:</span><span style=\"color: #D8DEE9\">Sublayout</span><span style=\"color: #81A1C1\">&gt;</span></code></pre>\n<p>In Sitecore MVC, the equivalent of the <em>Sublayout</em> control is to use the <em>Rendering</em>\nmethod on the <em>Sitecore.Mvc.Helpers.SitecoreHelper</em> within the view. For example:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #D8DEE9\">@Html</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">Sitecore</span><span style=\"color: #ECEFF4\">().</span><span style=\"color: #88C0D0\">Rendering</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">{00000000-0000-0000-0000-000000000000}</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">)</span></code></pre>\n<p>One important thing to note is that when adding a rendering programmatically, the\ncache settings specified on the sublayout/rendering definition item in Sitecore are\n<strong>NOT</strong> picked up. To define cache settings on the <em>Rendering</em> method, you must\nuse a method overload to specify the caching behaviour on the rendering. There is no\nintuitive overload where you can pass in values for <em>Cacheable</em> or <em>VaryByData</em> as with\nthe <em>WebControl</em>. To add caching to the example above, an anonymous type needs to be\ndefined, for example:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #D8DEE9\">@Html</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">Sitecore</span><span style=\"color: #ECEFF4\">().</span><span style=\"color: #88C0D0\">Rendering</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">{00000000-0000-0000-0000-000000000000}</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">new</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">Cacheable</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">true</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">Cache_VaryByData</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">true</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">})</span></code></pre>\n<p>There is no IntelliSense when defining this and so it is hard to remember the property\nnames without decompiling the Sitecore code or to look back at another project to see\nhow you achieved this previously. The following code provides a method which accepts\na strongly typed class to define the caching properties. It also provides the ability\nto cache a rendering by <em>TimeSpan</em> which could come in useful and isn't exposed as part\nof the standard Sitecore caching functionality.</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">class</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">RenderingCachingSettings</span>\n<span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">bool</span><span style=\"color: #ECEFF4\">?</span><span style=\"color: #D8DEE9FF\"> Cacheable </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">get;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">set;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">    </span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">TimeSpan</span><span style=\"color: #ECEFF4\">?</span><span style=\"color: #D8DEE9FF\"> Cache_Timeout </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">get;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">set;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">    </span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">bool</span><span style=\"color: #ECEFF4\">?</span><span style=\"color: #D8DEE9FF\"> Cache_VaryByData </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">get;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">set;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">    </span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">bool</span><span style=\"color: #ECEFF4\">?</span><span style=\"color: #D8DEE9FF\"> Cache_VaryByDevice </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">get;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">set;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">    </span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">bool</span><span style=\"color: #ECEFF4\">?</span><span style=\"color: #D8DEE9FF\"> Cache_VaryByLogin </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">get;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">set;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">    </span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">bool</span><span style=\"color: #ECEFF4\">?</span><span style=\"color: #D8DEE9FF\"> Cache_VaryByParameters </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">get;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">set;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">    </span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">bool</span><span style=\"color: #ECEFF4\">?</span><span style=\"color: #D8DEE9FF\"> Cache_VaryByQueryString </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">get;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">set;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">    </span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">bool</span><span style=\"color: #ECEFF4\">?</span><span style=\"color: #D8DEE9FF\"> Cache_VaryByUser </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">get;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">set;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #ECEFF4\">}</span>\n\n<span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">static</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">class</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">SitecoreHelperExtensions</span>\n<span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">static</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">HtmlString</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">CachedRendering</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #81A1C1\">this</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">SitecoreHelper</span><span style=\"color: #D8DEE9FF\"> sitecoreHelper</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">string</span><span style=\"color: #D8DEE9FF\"> pathOrId</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">RenderingCachingSettings</span><span style=\"color: #D8DEE9FF\"> renderingCachingSettings</span><span style=\"color: #ECEFF4\">)</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">return</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">sitecoreHelper</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">Rendering</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">pathOrId</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">renderingCachingSettings</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #ECEFF4\">}</span></code></pre>\n<p>This method is then used in a view such as:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #D8DEE9\">@Html</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">Sitecore</span><span style=\"color: #ECEFF4\">().</span><span style=\"color: #88C0D0\">CachedRendering</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">{00000000-0000-0000-0000-000000000000}</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">new</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">RenderingCachingSettings</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">Cacheable</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">true</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">Cache_VaryByQueryString</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">true</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">})</span>\n\n<span style=\"color: #D8DEE9\">@Html</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">Sitecore</span><span style=\"color: #ECEFF4\">().</span><span style=\"color: #88C0D0\">CachedRendering</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">{00000000-0000-0000-0000-000000000000}</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">new</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">RenderingCachingSettings</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">Cacheable</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">true</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">Cache_Timeout</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">new</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">TimeSpan</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #B48EAD\">0</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">0</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">0</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">30</span><span style=\"color: #ECEFF4\">)})</span></code></pre>\n<p>If the extension method does not show up, you will need to ensure you have the\nnamespace imported where it is defined. Adding the namespace to the <em>web.config</em>\nwithin the views directory will ensure it is available for all views, for example:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #81A1C1\">&lt;configuration&gt;</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #81A1C1\">&lt;system.web.webPages.razor&gt;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">&lt;pages</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">pageBaseType</span><span style=\"color: #D8DEE9FF\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">System.Web.Mvc.WebViewPage</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #81A1C1\">&gt;</span>\n<span style=\"color: #D8DEE9FF\">\t  </span><span style=\"color: #81A1C1\">&lt;add</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">namespace</span><span style=\"color: #D8DEE9FF\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">Your.Namespace</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">/&gt;</span>\n<span style=\"color: #D8DEE9FF\">\t</span><span style=\"color: #81A1C1\">&lt;/pages&gt;</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #81A1C1\">&lt;/system.web.webPages.razor&gt;</span>\n<span style=\"color: #81A1C1\">&lt;/configuration&gt;</span></code></pre>\n","tags":[{"title":"sitecore","path":"/tag/sitecore/"},{"title":"mvc","path":"/tag/mvc/"}],"references":[],"path":"/sitecore-mvc-programmatically-add-renderings-with-caching/"}},"context":{}}