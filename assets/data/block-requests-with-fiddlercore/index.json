{"hash":"9dc75de735af97e79df522afaa4679f2d3de84ae","data":{"post":{"title":"Block requests with FiddlerCore","description":"Using AutoResponder in FiddlerCore to block requests","date":"August 7, 2015","timeToRead":1,"content":"<p>Fiddler has some really powerful tools for aiding development and assisting with\ndebugging. One of these features is the AutoResponder tab:</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 559 329' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-f275d9ba02a826b3ef1f7993cd366b81'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-f275d9ba02a826b3ef1f7993cd366b81)' width='559' height='329' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAmAEADASIAAhEBAxEB/8QAGwAAAQUBAQAAAAAAAAAAAAAAAAEDBAYHAgX/xAA4EAABAgQCBAsGBwAAAAAAAAABAgMABAUREiEGEzGTFBUiQVFTVHGB0fAHFiNVYZIlUoORoaOx/8QAGAEBAQEBAQAAAAAAAAAAAAAAAAECBAP/xAAjEQACAQMDBAMAAAAAAAAAAAAAAQIDERIxQVEEFZKhE2GB/9oADAMBAAIRAxEAPwDQGKHp2lLC01OnhaEJsdWojL9LvgGj%2bnIxfidPzcJsW1bTn1XfFymKnKy02pL1SmUOJNygzPJ7tkOir055xTrtZel7m%2br1xKf8jC6Go1dZezhdKknZ1H5FSVS9P1NIQ5U6YtOGwBa6L5W1V%2bcxw3StO214mqlS0KzTfUqvnt2tRoCdLaI2AhVWk7pyOJZvCOaYUcJ%2bDUJN5f5EuWNuc7I126qtpeyYUdPlfkZ2KJp0VtkVSncm1jq1Zf1fSHXaR7QLB3jam8sEpOC%2b0WzAavF7XplT0YsTrCQOcu2B/iHvfCh/NpL7zDt9V6KXsOFHeq/IzZmhe0hTp1dXomN1NjdhdiPFuw2Rd9CqFXpNhxzSV%2bQmJ5TpIXLhQGrtstyRe9%2bYx6XvhQ/m0l98erTp9mpS3CJF9l9kkpC0EkXEF0lSi8pZW%2b72PSjCmpXhNv8Abna5CUWbrlmVHpKBCcXSXZGN2I81GkCCsBcs42i9lOKcRhSea%2bfPElNYl1C6VtEfRwRvKS3OrFcEjiyRO2Slt0nygFNkQcpOWHc0nyheFOdQv14QcKc7Ov14QzlyTGPAGnSR2ykue9sQnFkh2KW3SfKF4U52dfrwg4U52dfrwhnLkYx4E4skOxS26T5RIZZaYRgYbQ2jbhQkARE4wTjCMIxnYkrFz4Q2KuwXS0CjWDPBjF/2g5SerKopaEAyTlzZxABvcYNp6YlpZaSkDg7d%2bnEc4IIyU7wp6lO8VBZPUp3ioIIALJ6lO8VBZPUp3ioIIAiuy61KJS9q87gBAVbxMIiVKXQsuJOdyNUBcdF4IIA//9k=' /%3e%3c/svg%3e\" width=\"559\" alt=\"Screenshot of Fiddler AutoResponder\" data-srcset=\"/assets/static/fiddler-autoresponder.e36923f.d5475f9d371449129fb1dd7957a26cd4.jpg 559w\" data-sizes=\"(max-width: 559px) 100vw, 559px\" data-src=\"/assets/static/fiddler-autoresponder.e36923f.d5475f9d371449129fb1dd7957a26cd4.jpg\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/fiddler-autoresponder.e36923f.d5475f9d371449129fb1dd7957a26cd4.jpg\" width=\"559\" alt=\"Screenshot of Fiddler AutoResponder\"></noscript></p>\n<p>When writing integration tests, you may need to set up a scenario to test the application\nin a given state based on different responses from external systems. The following class\nshows an example of how you can intercept requests and respond with a 404 response if\nthe request is to a known advertising domain:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">static</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">class</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">BlockTrackingWebsiteRequestsContext</span>\n<span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">private</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">static</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">IEnumerable</span><span style=\"color: #ECEFF4\">&lt;</span><span style=\"color: #81A1C1\">string</span><span style=\"color: #ECEFF4\">&gt;</span><span style=\"color: #D8DEE9FF\"> BlockedDomains</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">get</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #81A1C1\">return</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">new</span><span style=\"color: #ECEFF4\">[]</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">flx1.com</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">mmtro.com</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">liverail.com</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">adform.net</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">t.co</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">pubmatic.com</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">doubleclick.net</span><span style=\"color: #ECEFF4\">\"</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">}</span>\n\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">static</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">void</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">SetupBlockTrackingWebsiteRequests</span><span style=\"color: #ECEFF4\">()</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #D8DEE9\">FiddlerApplication</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">BeforeRequest</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">+=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">ConfigureBlockTrackingWebsiteRequestsDelegate</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">}</span>\n\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">static</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">void</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">TearDownBlockTrackingWebsiteRequests</span><span style=\"color: #ECEFF4\">()</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #D8DEE9\">FiddlerApplication</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">BeforeRequest</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">-=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">ConfigureBlockTrackingWebsiteRequestsDelegate</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">}</span>\n\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">private</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">static</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">void</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">ConfigureBlockTrackingWebsiteRequestsDelegate</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #81A1C1\">Session</span><span style=\"color: #D8DEE9FF\"> targetSession</span><span style=\"color: #ECEFF4\">)</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">if</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">BlockedDomains</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">Any</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">targetSession</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">uriContains</span><span style=\"color: #ECEFF4\">))</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #D8DEE9\">targetSession</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">oRequest</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">FailSession</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #B48EAD\">404</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">Blocked</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">Fiddler blacklisted this domain</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #ECEFF4\">}</span></code></pre>\n<p>To register this functionality within your test, reference this class in the <em>SetUp</em>\nand <em>TearDown</em> methods to your test as follows. It is important to remember to deregister\nthe code at the end of your test so that it doesn't affect any future tests in your test\nfixture.</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #ECEFF4\">[</span><span style=\"color: #81A1C1\">SetUp</span><span style=\"color: #ECEFF4\">]</span>\n<span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">void</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">SetUp</span><span style=\"color: #ECEFF4\">()</span>\n<span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #D8DEE9\">BlockTrackingWebsiteRequestsContext</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">SetupBlockTrackingWebsiteRequests</span><span style=\"color: #ECEFF4\">()</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #ECEFF4\">}</span>\n\n<span style=\"color: #ECEFF4\">[</span><span style=\"color: #81A1C1\">TearDown</span><span style=\"color: #ECEFF4\">]</span>\n<span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">void</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">TearDown</span><span style=\"color: #ECEFF4\">()</span>\n<span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #D8DEE9\">BlockTrackingWebsiteRequestsContext</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">TearDownBlockTrackingWebsiteRequests</span><span style=\"color: #ECEFF4\">()</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #ECEFF4\">}</span></code></pre>\n","tags":[{"title":"automated-testing","path":"/tag/automated-testing/"},{"title":"debugging","path":"/tag/debugging/"}],"references":["http://docs.telerik.com/fiddler/KnowledgeBase/AutoResponder|Fiddler AutoResponder KB","http://fiddler.wikidot.com/fiddlercore-autorespond|FiddlerCore AutoResponder Wiki"],"path":"/block-requests-with-fiddlercore/"}},"context":{}}