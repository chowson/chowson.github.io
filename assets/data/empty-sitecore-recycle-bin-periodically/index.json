{"hash":"f79a9e6c9467a881cddc09e0e6a1b8254752d0cb","data":{"post":{"title":"Empty Sitecore Recycle Bin Periodically","description":"Empty Sitecore Recycle Bin Periodically","date":"July 26, 2016","timeToRead":2,"content":"<p>The recycle bin and archive within Sitecore are useful features\nfor content editors, the problem is that unless somebody proactively\nkeeps removing items from them, then they will keep growing in size.\nFor example, I once saw the archive tables reach 3GB.</p>\n<p>Firstly, the following Sitecore setting must be set to <em>true</em>\nto ensure items are put in the recycle bin rather than being\npermanently deleted when a content editor deletes an item:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #81A1C1\">&lt;setting</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">name</span><span style=\"color: #D8DEE9FF\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">RecycleBinActive</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">value</span><span style=\"color: #D8DEE9FF\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">true</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #81A1C1\">/&gt;</span></code></pre>\n<p>To remove the need for somebody to keep going into the Sitecore\nclient and cleaning up the recycle bin (or archive) manually, the following\nSitecore Job will keep checking the entries on a set interval and\nremove any items older than the configured <em>DaysToKeep</em> setting.\nFor example, you could configure the job to keep all items deleted in the past\n90 days but remove older items as they are unlikely to be needed:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">class</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">CleanupArchiveEntries</span>\n<span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">private</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">const</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">int</span><span style=\"color: #D8DEE9FF\"> PageSize </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">100</span><span style=\"color: #81A1C1\">;</span>\n\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">int</span><span style=\"color: #D8DEE9FF\"> DaysToKeep </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">get;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">set;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">string</span><span style=\"color: #D8DEE9FF\"> ArchiveName </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">get;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">set;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">string</span><span style=\"color: #D8DEE9FF\"> DatabaseName </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">get;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">set;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span>\n\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">void</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">Run</span><span style=\"color: #ECEFF4\">()</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #D8DEE9\">Assert</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">IsNotNullOrEmpty</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">ArchiveName</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">ArchiveName was not provided, please use recyclebin or archive</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #D8DEE9\">Assert</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">IsNotNullOrEmpty</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">DatabaseName</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">DatabaseName was not provided</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #D8DEE9\">Assert</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">IsNotNull</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">DaysToKeep</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">Days to keep was not provided</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #81A1C1\">;</span>\n\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">var</span><span style=\"color: #D8DEE9FF\"> archive </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">ArchiveManager</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">GetArchive</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">ArchiveName</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">Database</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">GetDatabase</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">DatabaseName</span><span style=\"color: #ECEFF4\">))</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #88C0D0\">LogEntryCount</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">archive</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">var</span><span style=\"color: #D8DEE9FF\"> entriesToRemove </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">FindOldArchiveEntries</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">archive</span><span style=\"color: #ECEFF4\">).</span><span style=\"color: #88C0D0\">ToArray</span><span style=\"color: #ECEFF4\">()</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #88C0D0\">RemoveOldArchiveEntries</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">archive</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">entriesToRemove</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #88C0D0\">LogEntryCount</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">archive</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">}</span>\n\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">private</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">static</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">ArchiveEntry</span><span style=\"color: #ECEFF4\">[]</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">GetArchivePageEntries</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #81A1C1\">Archive</span><span style=\"color: #D8DEE9FF\"> archive</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">int</span><span style=\"color: #D8DEE9FF\"> page</span><span style=\"color: #ECEFF4\">)</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">return</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">archive</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">GetEntries</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">page</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">PageSize</span><span style=\"color: #ECEFF4\">).</span><span style=\"color: #88C0D0\">ToArray</span><span style=\"color: #ECEFF4\">()</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">}</span>\n\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">private</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">ArchiveEntry</span><span style=\"color: #ECEFF4\">[]</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">GetArchiveEntryItemsToRemove</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #81A1C1\">ArchiveEntry</span><span style=\"color: #ECEFF4\">[]</span><span style=\"color: #D8DEE9FF\"> archiveEntries</span><span style=\"color: #ECEFF4\">)</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">return</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">archiveEntries</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">Where</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9FF\">item </span><span style=\"color: #81A1C1\">=&gt;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">item</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">ArchiveDate</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">&lt;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">DateTime</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">Now</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">AddDays</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">DaysToKeep</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">*</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">-</span><span style=\"color: #B48EAD\">1</span><span style=\"color: #ECEFF4\">)).</span><span style=\"color: #88C0D0\">ToArray</span><span style=\"color: #ECEFF4\">()</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">}</span>\n\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">private</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">void</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">LogEntryCount</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #81A1C1\">Archive</span><span style=\"color: #D8DEE9FF\"> archive</span><span style=\"color: #ECEFF4\">)</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">var</span><span style=\"color: #D8DEE9FF\"> archiveCount </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">archive</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">GetEntryCount</span><span style=\"color: #ECEFF4\">()</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #D8DEE9\">Log</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">Info</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">string</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">Format</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">Archive ({0}) contains {1} entries</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">archive</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">Name</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">archiveCount</span><span style=\"color: #ECEFF4\">),</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">this</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">}</span>\n\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">private</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">void</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">RemoveOldArchiveEntries</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #81A1C1\">Archive</span><span style=\"color: #D8DEE9FF\"> archive</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">ArchiveEntry</span><span style=\"color: #ECEFF4\">[]</span><span style=\"color: #D8DEE9FF\"> entriesToRemove</span><span style=\"color: #ECEFF4\">)</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #D8DEE9\">Log</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">Info</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">string</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">Format</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">Removing {0} entries</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">entriesToRemove</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">Length</span><span style=\"color: #ECEFF4\">),</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">this</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #81A1C1\">;</span>\n\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">foreach</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #81A1C1\">var</span><span style=\"color: #D8DEE9FF\"> itemToRemove </span><span style=\"color: #81A1C1\">in</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">entriesToRemove</span><span style=\"color: #ECEFF4\">)</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #D8DEE9\">Context</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">Job</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">Status</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">Processed</span><span style=\"color: #81A1C1\">++;</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #D8DEE9\">archive</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">RemoveEntries</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #81A1C1\">new</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">ID</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">itemToRemove</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">ArchivalId</span><span style=\"color: #ECEFF4\">))</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">}</span>\n\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">private</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">IEnumerable</span><span style=\"color: #ECEFF4\">&lt;</span><span style=\"color: #81A1C1\">ArchiveEntry</span><span style=\"color: #ECEFF4\">&gt;</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">FindOldArchiveEntries</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #81A1C1\">Archive</span><span style=\"color: #D8DEE9FF\"> archive</span><span style=\"color: #ECEFF4\">)</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">int</span><span style=\"color: #D8DEE9FF\"> page </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">0</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">var</span><span style=\"color: #D8DEE9FF\"> itemsToRemove </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">new</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">List</span><span style=\"color: #ECEFF4\">&lt;</span><span style=\"color: #81A1C1\">ArchiveEntry</span><span style=\"color: #ECEFF4\">&gt;()</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">var</span><span style=\"color: #D8DEE9FF\"> archiveItems </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">GetArchivePageEntries</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">archive</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">page</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #81A1C1\">;</span>\n\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">while</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">archiveItems</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">Any</span><span style=\"color: #ECEFF4\">())</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #81A1C1\">var</span><span style=\"color: #D8DEE9FF\"> pageItemsToRemove </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">GetArchiveEntryItemsToRemove</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">archiveItems</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #81A1C1\">if</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">pageItemsToRemove</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">Any</span><span style=\"color: #ECEFF4\">())</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #D8DEE9\">itemsToRemove</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">AddRange</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">pageItemsToRemove</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #ECEFF4\">}</span>\n\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #D8DEE9\">page</span><span style=\"color: #81A1C1\">++;</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #D8DEE9\">archiveItems</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">GetArchivePageEntries</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">archive</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">page</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">}</span>\n\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">return</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">itemsToRemove</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #ECEFF4\">}</span></code></pre>\n<p>To add the job to your application, create a new include file with\nthe following configuration:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #81A1C1\">&lt;configuration</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">xmlns</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #8FBCBB\">patch</span><span style=\"color: #D8DEE9FF\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">http://www.sitecore.net/xmlconfig/</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #81A1C1\">&gt;</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #81A1C1\">&lt;sitecore&gt;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">&lt;scheduling&gt;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">&lt;agent</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">type</span><span style=\"color: #D8DEE9FF\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">Your.Namespace.CleanupArchiveEntries, Mamba.Presentation.Website</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">method</span><span style=\"color: #D8DEE9FF\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">Run</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">interval</span><span style=\"color: #D8DEE9FF\">=</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">12:00:00</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #81A1C1\">&gt;</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #81A1C1\">&lt;DaysToKeep&gt;</span><span style=\"color: #D8DEE9FF\">365</span><span style=\"color: #81A1C1\">&lt;/DaysToKeep&gt;</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #81A1C1\">&lt;ArchiveName&gt;</span><span style=\"color: #D8DEE9FF\">recyclebin</span><span style=\"color: #81A1C1\">&lt;/ArchiveName&gt;</span><span style=\"color: #4C566A\">&lt;!-- recyclebin or archive --&gt;</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #81A1C1\">&lt;DatabaseName&gt;</span><span style=\"color: #D8DEE9FF\">master</span><span style=\"color: #81A1C1\">&lt;/DatabaseName&gt;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #81A1C1\">&lt;/agent&gt;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">&lt;/scheduling&gt;</span>\n<span style=\"color: #D8DEE9FF\">  </span><span style=\"color: #81A1C1\">&lt;/sitecore&gt;</span>\n<span style=\"color: #81A1C1\">&lt;/configuration&gt;</span></code></pre>\n<p>You can configure the <em>DaysToKeep</em>, <em>ArchiveName</em> and <em>DatabaseName</em>\nparameters to customise the job to run how you need it to be run. To run\nagainst multiple databases or multiple archives, simply specify multiple\n<em>agent</em> configuration nodes for each setup required.</p>\n<p>When the job runs, it will log something similar to the following\nif <em>INFO</em> logging is enabled:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440\"><code><span style=\"color: #D8DEE9FF\">12:27:32 ManagedPoolThread #2 INFO  Job started: Your.Namespace.CleanupArchiveEntries</span>\n<span style=\"color: #D8DEE9FF\">12:27:32 ManagedPoolThread #2 INFO  Archive (recyclebin) contains 218 entries</span>\n<span style=\"color: #D8DEE9FF\">12:27:32 ManagedPoolThread #2 INFO  Removing 61 entries</span>\n<span style=\"color: #D8DEE9FF\">12:27:36 ManagedPoolThread #2 INFO  Archive (recyclebin) contains 157 entries</span>\n<span style=\"color: #D8DEE9FF\">12:27:36 ManagedPoolThread #2 INFO  Job ended: Your.Namespace.CleanupArchiveEntries (units processed: 61)</span></code></pre>\n","tags":[{"title":"sitecore","path":"/tag/sitecore/"}],"references":[],"path":"/empty-sitecore-recycle-bin-periodically/"}},"context":{}}