{"componentChunkName":"component---src-templates-post-tsx","path":"/aws-bulk-password-retrieval/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"AWS: Bulk EC2 Password retrieval with Powershell","path":"/aws-bulk-password-retrieval","date":"November 12, 2015","dateIso":"2015-11-12T20:12:00.000Z","tags":["aws"],"references":["http://docs.aws.amazon.com/powershell/latest/reference/Index.html|AWS Tools for Windows Powershell Cmdlet Reference"],"description":"Using Powershell to describe all EC2 instances including administrator password"},"html":"<p>When using EC2, I find it a laborious process to log in to the AWS console and\nretrieve all of the information required to remote desktop to an instance and\nthen even more clicks to retrieve the administrator password. If you have created\nN instances using something like CloudFormation, then this time increases by N times\ndepending on the number of instances you want to access.</p>\n<p>The script at the end of this article retrieves all of the common information you\nneed about your EC2 instances with just one command as well as decrypting all of\nthe passwords saving a lot of time and effort. All that is required to run it\nis the <a href=\"https://aws.amazon.com/powershell/\">AWS Tools for Powershell</a> and the PEM\nfile the instances were assigned to so that the password can be decrypted.</p>\n<p>Here is an example of the output you will get:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 669px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2bd96a190fc2cce9a112b8c448d42071/2813e/describe-ec2-instances.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.229166666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAEABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABYBAQEBAAAAAAAAAAAAAAAAAAMAAf/aAAwDAQACEAMQAAABy4GKg2//xAAXEAADAQAAAAAAAAAAAAAAAAAAATFB/9oACAEBAAEFAscP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFRABAQAAAAAAAAAAAAAAAAAAARD/2gAIAQEAAT8haP/aAAwDAQACAAMAAAAQfC//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAZEAEAAwEBAAAAAAAAAAAAAAABABEhUfD/2gAIAQEAAT8QqKg8wgUAc0lvZ//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Describe EC2 instances\"\n        title=\"\"\n        src=\"/static/2bd96a190fc2cce9a112b8c448d42071/2813e/describe-ec2-instances.jpg\"\n        srcset=\"/static/2bd96a190fc2cce9a112b8c448d42071/7809d/describe-ec2-instances.jpg 192w,\n/static/2bd96a190fc2cce9a112b8c448d42071/4ecad/describe-ec2-instances.jpg 384w,\n/static/2bd96a190fc2cce9a112b8c448d42071/2813e/describe-ec2-instances.jpg 669w\"\n        sizes=\"(max-width: 669px) 100vw, 669px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>And the script to generate it:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token keyword\">Param</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token namespace\">[Parameter(Mandatory=$true)]</span><span class=\"token namespace\">[string]</span><span class=\"token variable\">$PemFilePath</span><span class=\"token punctuation\">,</span>\n  <span class=\"token namespace\">[Parameter(Mandatory=$true)]</span><span class=\"token namespace\">[string]</span><span class=\"token variable\">$AwsRegion</span><span class=\"token punctuation\">,</span>\n  <span class=\"token namespace\">[string]</span><span class=\"token variable\">$AwsAccessKey</span><span class=\"token punctuation\">,</span>\n  <span class=\"token namespace\">[string]</span><span class=\"token variable\">$AwsSecretyKey</span><span class=\"token punctuation\">,</span>\n  <span class=\"token namespace\">[string]</span><span class=\"token variable\">$ProfileName</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">Function</span> Describe-Instance\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">Param</span><span class=\"token punctuation\">(</span><span class=\"token namespace\">[Parameter(ValueFromPipeline=$true)]</span><span class=\"token namespace\">[Amazon.EC2.Model.Instance]</span><span class=\"token variable\">$instance</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">Process</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$resolvedPemFilePath</span> = <span class=\"token function\">Resolve-Path</span> <span class=\"token variable\">$PemFilePath</span>\n\n    <span class=\"token keyword\">try</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token variable\">$password</span> = Get-EC2PasswordData <span class=\"token operator\">-</span>InstanceId <span class=\"token variable\">$instance</span><span class=\"token punctuation\">.</span>InstanceId `\n                                      <span class=\"token operator\">-</span>PemFile <span class=\"token variable\">$resolvedPemFilePath</span> `\n                                      <span class=\"token operator\">-</span>Region <span class=\"token variable\">$AwsRegion</span> `\n                                      <span class=\"token operator\">-</span>AccessKey <span class=\"token variable\">$AwsAccessKey</span> `\n                                      <span class=\"token operator\">-</span>SecretKey <span class=\"token variable\">$AwsSecretyKey</span> `\n                                      <span class=\"token operator\">-</span>ProfileName <span class=\"token variable\">$ProfileName</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">{</span> <span class=\"token variable\">$password</span> = <span class=\"token string\">\"ERROR\"</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token variable\">$instanceInformation</span> = <span class=\"token function\">New-Object</span> PSObject\n    <span class=\"token function\">Add-Member</span> <span class=\"token operator\">-</span>InputObject <span class=\"token variable\">$instanceInformation</span> `\n               <span class=\"token operator\">-</span>MemberType NoteProperty `\n               <span class=\"token operator\">-</span>Name <span class=\"token string\">\"Name\"</span> <span class=\"token operator\">-</span>Value <span class=\"token punctuation\">(</span><span class=\"token variable\">$instance</span><span class=\"token punctuation\">.</span>Tags <span class=\"token punctuation\">|</span> ? <span class=\"token punctuation\">{</span> <span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>key <span class=\"token operator\">-eq</span> <span class=\"token string\">\"Name\"</span> <span class=\"token punctuation\">}</span> `\n                   <span class=\"token punctuation\">|</span> <span class=\"token function\">Select</span> <span class=\"token operator\">-</span>expand Value<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">Add-Member</span> <span class=\"token operator\">-</span>InputObject <span class=\"token variable\">$instanceInformation</span> `\n               <span class=\"token operator\">-</span>MemberType NoteProperty `\n               <span class=\"token operator\">-</span>Name <span class=\"token string\">\"Instance Id\"</span> `\n               <span class=\"token operator\">-</span>Value <span class=\"token variable\">$instance</span><span class=\"token punctuation\">.</span>InstanceId\n    <span class=\"token function\">Add-Member</span> <span class=\"token operator\">-</span>InputObject <span class=\"token variable\">$instanceInformation</span> `\n               <span class=\"token operator\">-</span>MemberType NoteProperty `\n               <span class=\"token operator\">-</span>Name <span class=\"token string\">\"Private Ip Address\"</span> `\n               <span class=\"token operator\">-</span>Value <span class=\"token variable\">$instance</span><span class=\"token punctuation\">.</span>PrivateIpAddress\n    <span class=\"token function\">Add-Member</span> <span class=\"token operator\">-</span>InputObject <span class=\"token variable\">$instanceInformation</span> `\n               <span class=\"token operator\">-</span>MemberType NoteProperty `\n               <span class=\"token operator\">-</span>Name Password `\n               <span class=\"token operator\">-</span>Value <span class=\"token variable\">$password</span>\n    <span class=\"token function\">Add-Member</span> <span class=\"token operator\">-</span>InputObject <span class=\"token variable\">$instanceInformation</span> `\n               <span class=\"token operator\">-</span>MemberType NoteProperty `\n               <span class=\"token operator\">-</span>Name State `\n               <span class=\"token operator\">-</span>Value <span class=\"token variable\">$instance</span><span class=\"token punctuation\">.</span>State<span class=\"token punctuation\">.</span>Name\n\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$instanceInformation</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\nGet-EC2Instance\t<span class=\"token operator\">-</span>Region <span class=\"token variable\">$awsRegion</span> `\n                <span class=\"token operator\">-</span>AccessKey <span class=\"token variable\">$awsAccessKey</span> <span class=\"token operator\">-</span>SecretKey <span class=\"token variable\">$awsSecretyKey</span> <span class=\"token operator\">-</span>ProfileName <span class=\"token variable\">$ProfileName</span> `\n                <span class=\"token punctuation\">|</span> <span class=\"token function\">Select-Object</span> <span class=\"token operator\">-</span>ExpandProperty instances `\n                <span class=\"token punctuation\">|</span> Describe-Instance `\n                <span class=\"token punctuation\">|</span> <span class=\"token function\">Sort-Object</span> Name `\n                <span class=\"token punctuation\">|</span> <span class=\"token function\">Format-Table</span></code></pre></div>\n<p>To add in the public IP address of the instance, just duplicate an <em>Add-Member</em>\nentry and change the <em>Name</em> parameter and the <em>Value</em> parameter to <em>PublicIpAddress</em>.</p>","timeToRead":2}},"pageContext":{"id":"e3971333-f7d0-5081-9bcc-7cc61c8d0ac8"}},"staticQueryHashes":["1942088059"],"slicesMap":{}}