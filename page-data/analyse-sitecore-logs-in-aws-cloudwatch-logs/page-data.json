{"componentChunkName":"component---src-templates-post-tsx","path":"/analyse-sitecore-logs-in-aws-cloudwatch-logs/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Analyse Sitecore logs in AWS CloudWatch Logs","path":"/analyse-sitecore-logs-in-aws-cloudwatch-logs","date":"January 12, 2016","dateIso":"2016-01-12T11:59:00.000Z","tags":["aws","sitecore"],"references":["https://marketplace.sitecore.net/Modules/S/Sitecore_Log_Analyzer.aspx|Sitecore Log Analyzer","http://docs.aws.amazon.com/powershell/latest/reference/items/Get-CWLLogEvents.html|AWS Powershell Get-CWLLogEvents Reference"],"description":"Analyse Sitecore logs in AWS CloudWatch Logs with Sitecore Log Analyzer"},"html":"<p>The previous post provided a <a href=\"/2015-12-16-sync-sitecore-logs-to-cloudwatch-logs\">step by step guide to Sync Sitecore Logs to AWS CloudWatch Logs</a>. However,\nonce the log entries are in <em>CloudWatch Logs</em>, then the options for\nanalysing them is very limited by the basic interface of <em>AWS CloudWatch\nLogs</em>.</p>\n<p>The <em>Sitecore Log Analyzer</em> is a really useful tool for analysing Log files\nproduced by a Sitecore application. It can scan multiple log files and group\nerrors by severity, monitor performance counters and get a visual overview of\nwebsite uptime and downtime intervals.</p>\n<p>The following Powershell script downloads log entries that are stored in\n<em>AWS CloudWatch Logs</em> and produces log files which are compatible with\nthe Sitecore Log Analyzer.</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token keyword\">Param</span><span class=\"token punctuation\">(</span>\n  <span class=\"token namespace\">[Parameter(Mandatory=$true)]</span><span class=\"token namespace\">[string]</span><span class=\"token variable\">$LogGroupName</span><span class=\"token punctuation\">,</span>\n  <span class=\"token namespace\">[Parameter(Mandatory=$true)]</span><span class=\"token namespace\">[string]</span><span class=\"token variable\">$LogStreamName</span><span class=\"token punctuation\">,</span>\n  <span class=\"token namespace\">[Parameter(Mandatory=$true)]</span><span class=\"token namespace\">[DateTime]</span><span class=\"token variable\">$StartTime</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">#US Format</span>\n  <span class=\"token namespace\">[Parameter(Mandatory=$true)]</span><span class=\"token namespace\">[DateTime]</span><span class=\"token variable\">$EndTime</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">#US Format</span>\n  <span class=\"token namespace\">[Parameter(Mandatory=$true)]</span><span class=\"token namespace\">[string]</span><span class=\"token variable\">$Region</span><span class=\"token punctuation\">,</span>\n  <span class=\"token namespace\">[Parameter(Mandatory=$true)]</span><span class=\"token namespace\">[string]</span><span class=\"token variable\">$ProfileName</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token variable\">$ErrorActionPreference</span> = <span class=\"token string\">\"Stop\"</span>\n<span class=\"token function\">New-Item</span> <span class=\"token punctuation\">.</span>\\Logs <span class=\"token operator\">-</span><span class=\"token function\">type</span> directory <span class=\"token operator\">-</span>Force <span class=\"token punctuation\">|</span> <span class=\"token function\">Out-Null</span>\n<span class=\"token function\">Remove-Item</span> <span class=\"token punctuation\">.</span>\\Logs\\<span class=\"token operator\">*</span><span class=\"token punctuation\">.</span>txt <span class=\"token operator\">-</span>Force\n\n<span class=\"token function\">Write-Host</span> Getting log entries between <span class=\"token variable\">$StartTime</span> and <span class=\"token variable\">$EndTime</span> <span class=\"token operator\">-</span>ForegroundColor Yellow\n<span class=\"token variable\">$logEvents</span> = <span class=\"token function\">Get-CWLLogEvents</span>  <span class=\"token operator\">-</span>LogGroupName <span class=\"token variable\">$LogGroupName</span> `\n                               <span class=\"token operator\">-</span>LogStreamName <span class=\"token variable\">$LogStreamName</span> `\n                               <span class=\"token operator\">-</span>StartTime <span class=\"token variable\">$startTime</span> `\n                               <span class=\"token operator\">-</span>EndTime <span class=\"token variable\">$endTime</span> `\n                               <span class=\"token operator\">-</span>StartFromHead <span class=\"token boolean\">$true</span> `\n                               <span class=\"token operator\">-</span>ProfileName <span class=\"token variable\">$ProfileName</span> `\n                               <span class=\"token operator\">-</span>Region <span class=\"token variable\">$Region</span>\n\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$logEvents</span><span class=\"token punctuation\">.</span>Events<span class=\"token punctuation\">.</span>Count <span class=\"token operator\">-eq</span> 0<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"No log entries found...\"</span> <span class=\"token operator\">-</span>ForegroundColor Cyan\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"Downloading log files...\"</span> <span class=\"token operator\">-</span>ForegroundColor Green\n  <span class=\"token keyword\">do</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$fileName</span> = <span class=\"token punctuation\">(</span><span class=\"token string\">\".\\Logs\\log.{0}.txt\"</span> <span class=\"token operator\">-</span>f <span class=\"token variable\">$logEvents</span><span class=\"token punctuation\">.</span>Events<span class=\"token punctuation\">[</span>0<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>IngestionTime<span class=\"token punctuation\">.</span>ToString<span class=\"token punctuation\">(</span><span class=\"token string\">\"yyyyMMdd.HHmmss\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token variable\">$logEvents</span><span class=\"token punctuation\">.</span>Events <span class=\"token punctuation\">|</span> <span class=\"token operator\">%</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"99999 {0} {1}\"</span> <span class=\"token operator\">-</span>f <span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>Timestamp<span class=\"token punctuation\">.</span>ToString<span class=\"token punctuation\">(</span><span class=\"token string\">\"HH:mm:ss\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> `\n                             <span class=\"token punctuation\">(</span><span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>Message  <span class=\"token operator\">-replace</span> <span class=\"token string\">\"[\\u001C,\\u0002,\\u0019,\\u001A]\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> `\n                        <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Out-File</span> <span class=\"token operator\">-</span>Encoding ascii <span class=\"token operator\">-</span>Append <span class=\"token variable\">$fileName</span> \n\n    <span class=\"token variable\">$logEvents</span> = <span class=\"token function\">Get-CWLLogEvents</span>  <span class=\"token operator\">-</span>LogGroupName <span class=\"token variable\">$LogGroupName</span> `\n                                   <span class=\"token operator\">-</span>LogStreamName <span class=\"token variable\">$LogStreamName</span> `\n                                   <span class=\"token operator\">-</span>StartTime <span class=\"token variable\">$startTime</span> `\n                                   <span class=\"token operator\">-</span>EndTime <span class=\"token variable\">$endTime</span> `\n                                   <span class=\"token operator\">-</span>StartFromHead <span class=\"token boolean\">$true</span> `\n                                   <span class=\"token operator\">-</span>ProfileName <span class=\"token variable\">$ProfileName</span> `\n                                   <span class=\"token operator\">-</span>Region <span class=\"token variable\">$Region</span> `\n                                   <span class=\"token operator\">-</span>nextToken <span class=\"token variable\">$logEvents</span><span class=\"token punctuation\">.</span>NextForwardToken\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">until</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$logEvents</span><span class=\"token punctuation\">.</span>Events<span class=\"token punctuation\">.</span>Count <span class=\"token operator\">-eq</span> 0<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Example script usage to download log entries from the 30th December 2015:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token punctuation\">.</span>\\CloudWatchLogs<span class=\"token punctuation\">.</span>ps1 <span class=\"token operator\">-</span>LogGroupName sitecore-logs `\n                     <span class=\"token operator\">-</span>LogStreamName i-xxxxxxxx `\n                     <span class=\"token operator\">-</span>StartTime <span class=\"token string\">\"12/30/2015 00:00:00\"</span> ` <span class=\"token comment\">#US Date Format</span>\n                     <span class=\"token operator\">-</span>EndTime <span class=\"token string\">\"12/31/2015 00:00:00\"</span> ` <span class=\"token comment\">#US Date Format</span>\n                     <span class=\"token operator\">-</span>Region eu-west-1 `\n                     <span class=\"token operator\">-</span>ProfileName myProfile</code></pre></div>\n<p>As per the AWS Powershell documentation for <em>Get-CWLLogEvents</em>, the response\nhas a maximum size of 1MB or 10,000 log events so multiple log files will be created\nin a subfolder called <em>Logs</em> relative to where the script is being run.</p>\n<h2>Viewing the Logs</h2>\n<p>Once the script has finished executing, the Sitecore Log Analyzer can be used as\nnormal by analysing the <em>Logs</em> folder created, e.g.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b9bb49a25560ce3bc77f3c7ec07dfa15/fd879/SitecoreLogAnalyzer-Result.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.52083333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIEAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB7mFEqMIR/8QAGxAAAgIDAQAAAAAAAAAAAAAAAAEREgIDEyH/2gAIAQEAAQUCg6e3RYetysD/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAXEAADAQAAAAAAAAAAAAAAAAAAATEg/9oACAEBAAY/AiEeP//EABsQAQEBAAIDAAAAAAAAAAAAAAEAESExQVHR/9oACAEBAAE/IR+5IjXEN9LEhO92Hm//2gAMAwEAAgADAAAAEIT/AP/EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/EFf/xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPxCq/8QAGxABAAICAwAAAAAAAAAAAAAAAQARIUExUXH/2gAIAQEAAT8QAa+RUpZMJCFOSCjAsFApLECO3U//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"SitecoreLogAnalyzer Result\"\n        title=\"\"\n        src=\"/static/b9bb49a25560ce3bc77f3c7ec07dfa15/212bf/SitecoreLogAnalyzer-Result.jpg\"\n        srcset=\"/static/b9bb49a25560ce3bc77f3c7ec07dfa15/7809d/SitecoreLogAnalyzer-Result.jpg 192w,\n/static/b9bb49a25560ce3bc77f3c7ec07dfa15/4ecad/SitecoreLogAnalyzer-Result.jpg 384w,\n/static/b9bb49a25560ce3bc77f3c7ec07dfa15/212bf/SitecoreLogAnalyzer-Result.jpg 768w,\n/static/b9bb49a25560ce3bc77f3c7ec07dfa15/fd879/SitecoreLogAnalyzer-Result.jpg 1010w\"\n        sizes=\"(max-width: 768px) 100vw, 768px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>","timeToRead":2}},"pageContext":{"id":"d34158cc-fb23-5802-92a2-e695bddb8dcf"}},"staticQueryHashes":["1942088059"],"slicesMap":{}}