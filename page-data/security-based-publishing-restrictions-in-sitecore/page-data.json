{"componentChunkName":"component---src-templates-post-tsx","path":"/security-based-publishing-restrictions-in-sitecore/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Security Based Publishing Restrictions in Sitecore","path":"/security-based-publishing-restrictions-in-sitecore","date":"August 19, 2015","dateIso":"2015-08-19T16:18:00.000Z","tags":["sitecore"],"references":[],"description":"Providing publishing based on item security"},"html":"<h2>Problem...</h2>\n<p>In order to grant a user permissions to publish in Sitecore, they need to be part\nof the <em>Sitecore Client Publishing</em> role. Once a user is a member of this role,\nthe publishing buttons become visible to the user within the content editor ribbon\nas well as the main menu. The consequence of this is that it grants the user permission\nto publish everything via a site publish and in larger applications this can prevent\nother users from publishing for hours with no easy way to cancel the publish job.</p>\n<p>Out of the box Sitecore provides a couple of options around this:</p>\n<ul>\n<li>Remove read permissions to the 'Publish site' option for the role. To do this, edit the read permission on the core database item <em>/sitecore/content/Applications/Content Editor/Menues/Publish/Publish Site</em>.\n<ul>\n<li>Issue: A user could still initiate a publish from the /sitecore root item and include</li>\n</ul>\n</li>\n</ul>\n<p>all sub-items, effectively performing a site publish.</p>\n<ul>\n<li>Configure a publishing scheduled task to perform an periodic incremental publish picking up all new changes.\n<ul>\n<li>Issue: If workflow isn't enabled on all items you can end up with things published</li>\n</ul>\n</li>\n</ul>\n<p>that are incomplete.</p>\n<h2>Solution...</h2>\n<p>A potential solution around this is to hide the publishing buttons on items which the\ncontext user doesn't have permissions to write to, therefore only allowing them to publish\nsections of the tree that they can author. For areas of the tree where they only have read\naccess, the publishing button will be hidden. To achieve this, you can follow these steps:</p>\n<ol>\n<li>Create a new class that inherits the Sitecore default command and add logic to the</li>\n</ol>\n<p><em>QueryState</em> method to check for write access, for example:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PublishItemCheckSecurity</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">PublishItem</span></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token return-type class-name\">CommandState</span> <span class=\"token function\">QueryState</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CommandContext</span> context<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> item <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span>Items<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> baseState <span class=\"token operator\">=</span> <span class=\"token keyword\">base</span><span class=\"token punctuation\">.</span><span class=\"token function\">QueryState</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> baseState <span class=\"token operator\">==</span> CommandState<span class=\"token punctuation\">.</span>Enabled <span class=\"token operator\">&amp;&amp;</span> item <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>item<span class=\"token punctuation\">.</span>Security<span class=\"token punctuation\">.</span><span class=\"token function\">CanWrite</span><span class=\"token punctuation\">(</span>Context<span class=\"token punctuation\">.</span>User<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">?</span> CommandState<span class=\"token punctuation\">.</span>Hidden\n            <span class=\"token punctuation\">:</span> baseState<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"2\">\n<li>Patch in the new command referenced in step 1 to replace the default Sitecore command:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>patch</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.sitecore.net/xmlconfig/<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>sitecore</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>commands</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>command</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item:publishnow<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">patch:</span>attribute</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>type<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Your.Namespace.PublishItemCheckSecurity, Your.Namespace<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token namespace\">patch:</span>attribute</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>command</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>commands</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>sitecore</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Once your solution recompiled, create a new user which is a member of the <em>Sitecore Client Publishing</em>\nrole and then viewing different content items should see the button appearing for items\nthe user can write to and disappearing for items that they cannot.</p>","timeToRead":2}},"pageContext":{"id":"978b9925-214f-5562-94c4-dd2dee706faf"}},"staticQueryHashes":["1942088059"],"slicesMap":{}}