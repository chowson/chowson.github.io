{"componentChunkName":"component---src-templates-post-tsx","path":"/deploy-storybook-with-azure-devops-pipelines/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Deploy Storybook to an Azure storage static website with Azure Devops Pipelines","path":"/deploy-storybook-with-azure-devops-pipelines","date":"July 12, 2020","dateIso":"2020-07-12T12:54:11.000Z","tags":["Azure","Devops"],"references":["https://storybook.js.org/|Storybook","https://azure.microsoft.com/en-gb/services/devops/pipelines/|Azure Devops Pipelines","https://azure.microsoft.com/en-gb/pricing/details/storage/blobs/|Azure Storage Blobs Pricing"],"description":"A guide to deploying Storybook to an Azure Blob Storage static website with Azure Devops Pipelines"},"html":"<p>Storybook is a great front end development tool. It is also a good platform for team\ncollaboration, allowing designers and QA an early preview. This provides early feedback\nreducing the cycle time of the feature developed.</p>\n<p>Azure Storage static website hosting is a perfect choice as the hosting\nprovider. It is <a href=\"https://azure.microsoft.com/en-gb/pricing/details/storage/blobs/\">cheap</a>\nand quick to get started.</p>\n<p>This guide demonstrates how to configure a pipeline that publishes Storybook to a static\nwebsite hosted in Azure storage for each feature branch.</p>\n<div class=\"list--nopadding list--h2\">\n<ol>\n<li>\n<h2>Setup a Static website in Azure Storage</h2>\n<p>There are a few different ways to achieve this. The <a href=\"https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blob-static-website-how-to\">how to guide</a> from Microsoft Docs is the best place to getting your static website setup.</p>\n</li>\n<li>\n<h2>Connect Azure Devops to Azure</h2>\n<p>Next, you'll need to connect your Azure Devops project to your Azure subscription. To do this,a  <a href=\"https://docs.microsoft.com/en-us/azure/devops/pipelines/library/connect-to-azure?view=azure-devops\">service connection</a> will need to be setup.</p>\n</li>\n<li>\n<h2>Setup the pipeline</h2>\n<p>The best way to configure Azure Devops Pipelines is with code using YAML.\nThe pipeline is then part of your repository enabling version control. This\nprovides history and comments about how the pipeline evolved.</p>\n <div class=\"list--reset\">\n<p>The pipeline below performs the following steps:</p>\n<ol>\n<li>Restores &#x26; caches NPM packages to enhance performance</li>\n<li>Runs <code class=\"language-text\">npm ci</code> to restore NPM packages</li>\n<li>Runs <code class=\"language-text\">npm run build-storybook</code> to build Storybook</li>\n<li>Copies the static website to Azure storage with a folder prefix of the current branch name (<code class=\"language-text\">$(Build.SourceBranchName</code>)</li>\n</ol>\n</li>\n</ol>\n  </div>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">trigger</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> none\n\n<span class=\"token key atrule\">pool</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">vmImage</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'ubuntu-latest'</span>\n\n<span class=\"token key atrule\">variables</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">SrcFolder</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'src'</span>\n  <span class=\"token key atrule\">StorageAccountName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'StorageAccountName'</span>\n  <span class=\"token key atrule\">npm_config_cache</span><span class=\"token punctuation\">:</span> $(Pipeline.Workspace)/.npm\n  <span class=\"token key atrule\">FolderPrefix</span><span class=\"token punctuation\">:</span> $(Build.SourceBranchName)\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">job</span><span class=\"token punctuation\">:</span> Publish_Storybook_to_Static_Site\n  <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">task</span><span class=\"token punctuation\">:</span> Cache@2\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'npm | \"$(Agent.OS)\" | $(SrcFolder)/package-lock.json'</span>\n      <span class=\"token key atrule\">restoreKeys</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          npm | \"$(Agent.OS)\"</span>\n      <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> $(npm_config_cache)\n    <span class=\"token key atrule\">displayName</span><span class=\"token punctuation\">:</span> Cache npm\n\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">task</span><span class=\"token punctuation\">:</span> Npm@1\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'custom'</span>\n      <span class=\"token key atrule\">customCommand</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'ci'</span>\n      <span class=\"token key atrule\">workingDir</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'$(SrcFolder)'</span>\n    <span class=\"token key atrule\">displayName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'npm ci'</span>\n      \n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">task</span><span class=\"token punctuation\">:</span> Npm@1\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'custom'</span>\n      <span class=\"token key atrule\">workingDir</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'$(SrcFolder)'</span>\n      <span class=\"token key atrule\">customCommand</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'run build-storybook'</span>\n    <span class=\"token key atrule\">displayName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Build Storybook'</span>\n\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">task</span><span class=\"token punctuation\">:</span> AzureFileCopy@3\n    <span class=\"token key atrule\">displayName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'AzureBlob File Copy'</span>\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">SourcePath</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'$(SrcFolder)/storybook-static'</span>\n      <span class=\"token key atrule\">azureSubscription</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'ServiceConnection_Name'</span>\n      <span class=\"token key atrule\">Destination</span><span class=\"token punctuation\">:</span> AzureBlob\n      <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> $(StorageAccountName)\n      <span class=\"token key atrule\">ContainerName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'$web'</span>\n      <span class=\"token key atrule\">BlobPrefix</span><span class=\"token punctuation\">:</span> $(FolderPrefix)</code></pre></div>\n</div>\n<p>Once committed to the repository, log into Azure Devops and create\na new pipeline using the wizard. Select where your code is and then\npick the YAML file of your pipeline.</p>","timeToRead":1}},"pageContext":{"id":"692310d6-e20c-5d16-a389-8ac0ad8a3358"}},"staticQueryHashes":["1942088059"],"slicesMap":{}}