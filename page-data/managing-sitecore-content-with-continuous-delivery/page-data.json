{"componentChunkName":"component---src-templates-post-tsx","path":"/managing-sitecore-content-with-continuous-delivery/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Managing Sitecore Content with Continuous Delivery","path":"/managing-sitecore-content-with-continuous-delivery","date":"July 18, 2017","dateIso":"2017-07-18T08:45:34.000Z","tags":["sitecore"],"references":[],"description":"Simple Sitecore Content Feature Toggle for Continuous Delivery"},"html":"<p>The standard way in Sitecore to prevent content being seen by users before\nit's ready is to use publishing restrictions. Marking the content as unpublishable\nensures any publishes don't push the content to the web database.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0e486e04eae23435166a236675c32d13/a820a/item-publishing-restrictions.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.645833333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAGABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdKwSD//xAAWEAADAAAAAAAAAAAAAAAAAAAAAxT/2gAIAQEAAQUCnUTJJkn/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAXEAADAQAAAAAAAAAAAAAAAAAAATMy/9oACAEBAAY/AsImiaP/xAAYEAACAwAAAAAAAAAAAAAAAAABIRARQf/aAAgBAQABPyFtEz2ZH//aAAwDAQACAAMAAAAQcA//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAEAAgMBAAAAAAAAAAAAAAABANERMWHx/9oACAEBAAE/EA2jdhrhyeK3MVDc/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Item publishing restrictions\"\n        title=\"\"\n        src=\"/static/0e486e04eae23435166a236675c32d13/212bf/item-publishing-restrictions.jpg\"\n        srcset=\"/static/0e486e04eae23435166a236675c32d13/7809d/item-publishing-restrictions.jpg 192w,\n/static/0e486e04eae23435166a236675c32d13/4ecad/item-publishing-restrictions.jpg 384w,\n/static/0e486e04eae23435166a236675c32d13/212bf/item-publishing-restrictions.jpg 768w,\n/static/0e486e04eae23435166a236675c32d13/a820a/item-publishing-restrictions.jpg 996w\"\n        sizes=\"(max-width: 768px) 100vw, 768px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Whilst developing a new area of the site, continuous delivery will deploy partially\ncompleted pages. To ensure the new content is hidden from users, it is marked\nas  unpublishable. The problem with this is the new content needs to be visible on test environments\nand each deployment to the test environment resets the item to unpublishable.</p>\n<p>Having to mark the items as publishable and publish them on the test environments breaks\nthe continuous delivery deployment pipeline because it introduces a manual step. Continuous\ndelivery aims to have a fully automated process that you can deploy and release any version\nof the software to any environment.</p>\n<p>The following solution allows new content to be deployed to both master and web\ndatabases with continuous delivery but prevents public users from seeing it.</p>\n<p>To achieve this, a <em>Controller Rendering</em> is added to a new page and returns\n404 response unless some particular criteria is matched. The example provided checks for\nthe existence of a known querystring:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SitecoreContentFeatureToggleController</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">Controller</span></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">const</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> ToggleOverrideQueryStringKey <span class=\"token operator\">=</span> <span class=\"token string\">\"SomethingNotEasyToGuess\"</span><span class=\"token punctuation\">;</span>\n\t\n    <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\">ActionResult</span> <span class=\"token function\">Index</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">ToggleOverridePresent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">EmptyResult</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token function\">HttpNotFound</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">bool</span></span> <span class=\"token function\">ToggleOverridePresent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> enableToggleOverride <span class=\"token operator\">=</span> Request<span class=\"token punctuation\">.</span>QueryString<span class=\"token punctuation\">[</span>ToggleOverrideQueryStringKey<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token operator\">!</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">.</span><span class=\"token function\">IsNullOrEmpty</span><span class=\"token punctuation\">(</span>enableToggleOverride<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> enableToggleOverride<span class=\"token punctuation\">.</span><span class=\"token function\">Equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"true\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Other simple checks could be implemented instead of checking the querystring:</p>\n<ul>\n<li>Existence of a particular request header</li>\n<li>Existence of a particular cookie (with particular value)</li>\n<li>Request IP address whitelist</li>\n</ul>\n<p>When making the <em>Controller Rendering</em>, it is important to ensure the rendering's caching\nfields are all unchecked. If it is marked as cacheable then the check is only applied to the first\nvisitor rather than to each request.</p>\n<p>As the title suggests, this is a simple feature toggle and does not prevent\nother parts of the site from linking to the new content. For example, using this\nfor news articles would not prevent the new article being picked up on the news\nlanding page.</p>\n<p>To use this approach, simply create the controller rendering and add it to the\ncontent item instead of marking the item as unpublishable.</p>\n<h2>Benefits of Approach</h2>\n<ul>\n<li>The deployment process for each environment is the same.</li>\n<li>The test team don't need to make the new content items publishable and then publish them\non each deployment to the test environment.</li>\n<li>Each deployment to the UAT environment won't require the unpublishable flag removing and\nthe content being published.</li>\n<li>If the client wants to see the new features on the live site, then they can.</li>\n<li>Public users receive a 404 response when they hit the URL.</li>\n</ul>\n<h2>When to use this?</h2>\n<ul>\n<li>When the new content is isolated - e.g. Developing a new homepage - publishing the item to a URL with the feature toggle rendering will allow authorised people to see the new page on the without the public being able to see it.</li>\n</ul>\n<h2>When not to use it?</h2>\n<ul>\n<li>Any new page which other pages have been set up to link to.</li>\n</ul>","timeToRead":2}},"pageContext":{"id":"d4a48c37-2956-5cc4-a3f0-af01c101bf87"}},"staticQueryHashes":["1942088059"],"slicesMap":{}}