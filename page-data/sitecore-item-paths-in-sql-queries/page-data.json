{"componentChunkName":"component---src-templates-post-tsx","path":"/sitecore-item-paths-in-sql-queries/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Sitecore Item Paths in SQL Queries","path":"/sitecore-item-paths-in-sql-queries","date":"September 03, 2016","dateIso":"2016-09-03T09:45:34.000Z","tags":["sitecore","debugging","sql"],"references":[],"description":"Sitecore Item Paths in SQL Queries"},"html":"<p>Developing or debugging Sitecore applications can quite often lead\nto executing SQL queries to try and work out how something works or\nwhere the issue lies.</p>\n<p>One piece of information that cannot be easily accessed in an\nSQL query is the hierarchy of items because the item path isn't saved\nas a field value within the database. Item hierarchy is instead stored\nby each row in the <em>Items</em> table storing the ID of its parent\nin the <em>ParentID</em> column.</p>\n<p>Running the following SQL statement will create a\nview which is a copy of the <em>Items</em> table but with an additional\ncolumn defining the item's full path:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">VIEW</span> <span class=\"token punctuation\">[</span>dbo<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">[</span>ItemsPath<span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">AS</span>\n    <span class=\"token keyword\">WITH</span> ItemsTable <span class=\"token punctuation\">(</span>ItemPath<span class=\"token punctuation\">,</span> ID<span class=\"token punctuation\">,</span> Name<span class=\"token punctuation\">,</span> TemplateID<span class=\"token punctuation\">,</span> MasterID<span class=\"token punctuation\">,</span> ParentID<span class=\"token punctuation\">,</span> Created<span class=\"token punctuation\">,</span> Updated<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">AS</span>\n    <span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">SELECT</span> CAST<span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span> <span class=\"token operator\">+</span> base<span class=\"token punctuation\">.</span>Name <span class=\"token keyword\">AS</span> nvarchar<span class=\"token punctuation\">(</span>MAX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> ItemPath<span class=\"token punctuation\">,</span>\n            base<span class=\"token punctuation\">.</span>ID<span class=\"token punctuation\">,</span> base<span class=\"token punctuation\">.</span>Name<span class=\"token punctuation\">,</span> base<span class=\"token punctuation\">.</span>TemplateID<span class=\"token punctuation\">,</span> base<span class=\"token punctuation\">.</span>MasterID<span class=\"token punctuation\">,</span> base<span class=\"token punctuation\">.</span>ParentID<span class=\"token punctuation\">,</span> base<span class=\"token punctuation\">.</span>Created<span class=\"token punctuation\">,</span> base<span class=\"token punctuation\">.</span>Updated\n\t\t\t\n        <span class=\"token keyword\">FROM</span> Items <span class=\"token keyword\">as</span> base\n        <span class=\"token keyword\">WHERE</span> base<span class=\"token punctuation\">.</span>ID <span class=\"token operator\">=</span> <span class=\"token string\">'11111111-1111-1111-1111-111111111111'</span>\t\n\n        <span class=\"token keyword\">UNION</span> <span class=\"token keyword\">ALL</span>\n\t\n        <span class=\"token keyword\">SELECT</span> CAST<span class=\"token punctuation\">(</span>ItemPath <span class=\"token operator\">+</span> <span class=\"token string\">'/'</span> <span class=\"token operator\">+</span> child<span class=\"token punctuation\">.</span>Name <span class=\"token keyword\">AS</span> nvarchar<span class=\"token punctuation\">(</span>MAX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            child<span class=\"token punctuation\">.</span>ID<span class=\"token punctuation\">,</span> child<span class=\"token punctuation\">.</span>Name<span class=\"token punctuation\">,</span> child<span class=\"token punctuation\">.</span>TemplateID<span class=\"token punctuation\">,</span> child<span class=\"token punctuation\">.</span>MasterID<span class=\"token punctuation\">,</span> child<span class=\"token punctuation\">.</span>ParentID<span class=\"token punctuation\">,</span> child<span class=\"token punctuation\">.</span>Created<span class=\"token punctuation\">,</span> child<span class=\"token punctuation\">.</span>Updated\n\t\t\t\n        <span class=\"token keyword\">FROM</span> ItemsTable <span class=\"token keyword\">as</span> parent \n        <span class=\"token keyword\">INNER</span> <span class=\"token keyword\">JOIN</span> Items <span class=\"token keyword\">as</span> child \n            <span class=\"token keyword\">ON</span> child<span class=\"token punctuation\">.</span>ParentID <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">.</span>ID \n    <span class=\"token punctuation\">)</span>\t\n    <span class=\"token keyword\">SELECT</span> ItemPath<span class=\"token punctuation\">,</span> ID<span class=\"token punctuation\">,</span> Name<span class=\"token punctuation\">,</span> TemplateID<span class=\"token punctuation\">,</span> MasterID<span class=\"token punctuation\">,</span> ParentID<span class=\"token punctuation\">,</span> Created<span class=\"token punctuation\">,</span> Updated\n    <span class=\"token keyword\">FROM</span> ItemsTable\nGO</code></pre></div>\n<p>Running the query below will return the following result:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> ItemsPath</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a8f808e245736226822bc42137f818d9/34403/ItemPaths.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.958333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAFABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB2AUH/8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABBQJ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAGBAAAgMAAAAAAAAAAAAAAAAAABARQYH/2gAIAQEAAT8hrCV//9oADAMBAAIAAwAAABCAD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABoQAAICAwAAAAAAAAAAAAAAAAABEUEhUWH/2gAIAQEAAT8Ql8BMrsztn//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Item paths in SQL\"\n        title=\"\"\n        src=\"/static/a8f808e245736226822bc42137f818d9/212bf/ItemPaths.jpg\"\n        srcset=\"/static/a8f808e245736226822bc42137f818d9/7809d/ItemPaths.jpg 192w,\n/static/a8f808e245736226822bc42137f818d9/4ecad/ItemPaths.jpg 384w,\n/static/a8f808e245736226822bc42137f818d9/212bf/ItemPaths.jpg 768w,\n/static/a8f808e245736226822bc42137f818d9/5ef17/ItemPaths.jpg 1152w,\n/static/a8f808e245736226822bc42137f818d9/34403/ItemPaths.jpg 1323w\"\n        sizes=\"(max-width: 768px) 100vw, 768px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Once the view is created, queries can be run like the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">--Returns all descendants of the /sitecore/template item</span>\n\n<span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> \n<span class=\"token keyword\">FROM</span> ItemsPath\n<span class=\"token keyword\">WHERE</span> ItemPath <span class=\"token operator\">LIKE</span> <span class=\"token string\">'/sitecore/templates%'</span>\n\n<span class=\"token comment\">--Returns all rows in the WorkflowHistory table for all </span>\n<span class=\"token comment\">--descendants of the news item (/sitecore/content/Home/News)</span>\n\n<span class=\"token keyword\">SELECT</span>\t WorkflowHistory<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span>\n<span class=\"token keyword\">FROM</span> WorkflowHistory\n<span class=\"token keyword\">JOIN</span> dbo<span class=\"token punctuation\">.</span>ItemsPath <span class=\"token keyword\">ON</span> ItemsPath<span class=\"token punctuation\">.</span>ID <span class=\"token operator\">=</span> WorkflowHistory<span class=\"token punctuation\">.</span>ItemID\n<span class=\"token keyword\">WHERE</span> ItemPath <span class=\"token operator\">LIKE</span> <span class=\"token string\">'/sitecore/content/Home/News%'</span></code></pre></div>","timeToRead":1}},"pageContext":{"id":"5e7040bf-f2cb-58bf-85e3-a5a55990a7c5"}},"staticQueryHashes":["1942088059"],"slicesMap":{}}