{"componentChunkName":"component---src-templates-post-tsx","path":"/vuejs-sitecore-mvc-and-experience-editor/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Vue.js, Sitecore MVC and the Experience Editor","path":"/vuejs-sitecore-mvc-and-experience-editor","date":"September 18, 2019","dateIso":"2019-09-18T18:01:12.000Z","tags":["sitecore"],"references":[],"description":"Vue.js, Sitecore MVC and the Experience Editor"},"html":"<p>There is a compatibility issue between Vue.js and Sitecore MVC experience editor with\nSitecore 9.1. This issue is with a standard Sitecore MVC solution rather than Sitecore JSS.</p>\n<h2>The Problem</h2>\n<p>The problem occurs when adding a new component in experience editor. The problem\nmanifests itself by appearing to ignore placeholder settings and show you the treeview\nfor selecting a rendering:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 711px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2262b6974abf5ef0de9c8d3dd1232075/a8e5b/select-a-rendering.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.1875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABJUlEQVR42q2Sy2qEQBBF+1t0IboaXAtCXMjoUmY0Tn4t6/xGFsk3ZJHXwgcMJqMxGrV93NANishAHjMFh6qimtuX7iKapuHCMGAYBkzThK7rkGWZoyjKlCVJgiAIEEXxKKqqYrVagWw2G/j+JXzfx26349l1XWy3W3iex2uG4zhYr9ewLOsotm1zSNu2KMoKZfmFqqrAepbrukbXdbxnsLrv+x8hGAY8Be/YJ2/4zHOwYGJN0+A/QYZhAG37ycEoyGDB5n+BC44x1nOH8/mvHC5dnEXw7A7PKrh81JM/5dgtJ63NuLRzKKWc+WIvaSjFoayRFDXq2VmSJAmiKOKEYciJ45j3LGdZhjRNJw5piiL/wGO0x9XNPczrW9w9vCB4fUYQRvgGp++mTO7JP6EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Select a rendering\"\n        title=\"\"\n        src=\"/static/2262b6974abf5ef0de9c8d3dd1232075/a8e5b/select-a-rendering.png\"\n        srcset=\"/static/2262b6974abf5ef0de9c8d3dd1232075/8514f/select-a-rendering.png 192w,\n/static/2262b6974abf5ef0de9c8d3dd1232075/804b2/select-a-rendering.png 384w,\n/static/2262b6974abf5ef0de9c8d3dd1232075/a8e5b/select-a-rendering.png 711w\"\n        sizes=\"(max-width: 711px) 100vw, 711px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>The browser then displays an alert saying \"An error occurred.\" and the following\nin your logs:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">Exception: System.InvalidOperationException\nMessage: placeholderKey\nSource: Sitecore.ExperienceEditor\n   at Sitecore.Pipelines.ExecutePageEditorAction.InsertRendering.Process<span class=\"token punctuation\">(</span>PipelineArgs args<span class=\"token punctuation\">)</span>\n   at <span class=\"token punctuation\">(</span>Object , Object <span class=\"token punctuation\">)</span>\n   at Sitecore.Pipelines.CorePipeline.Run<span class=\"token punctuation\">(</span>PipelineArgs args<span class=\"token punctuation\">)</span>\n   at Sitecore.Pipelines.DefaultCorePipelineManager.Run<span class=\"token punctuation\">(</span>String pipelineName, PipelineArgs args, String pipelineDomain, Boolean failIfNotExists<span class=\"token punctuation\">)</span>\n   at Sitecore.Pipelines.DefaultCorePipelineManager.Run<span class=\"token punctuation\">(</span>String pipelineName, PipelineArgs args, String pipelineDomain<span class=\"token punctuation\">)</span>\n   at Sitecore.Pipelines.ExecutePageEditorAction.ExecutePageEditorActionPipeline.Run<span class=\"token punctuation\">(</span>ExecutePageEditorActionArgs args<span class=\"token punctuation\">)</span>\n   at Sitecore.Shell.Applications.WebEdit.Palette.OnPreInit<span class=\"token punctuation\">(</span>EventArgs e<span class=\"token punctuation\">)</span>\n   at System.Web.UI.Page.PerformPreInit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n   at System.Web.UI.Page.ProcessRequestMain<span class=\"token punctuation\">(</span>Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint<span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Why does this happen?</h2>\n<p>The reason this happens is because both Sitecore and Vue.js need to use a <em>key</em> attribute.</p>\n<ul>\n<li>For Vue.js, the key attribute is a special attribute: <a href=\"https://vuejs.org/v2/api/#key\">https://vuejs.org/v2/api/#key</a></li>\n<li>For Sitecore, the key attribute is used on the placeholder DOM elements added to the</li>\n</ul>\n<p>page in experience editor</p>\n<p>With both Vue.js and Experience Editor together, Vue.js removes the key attribute so when you\nadd a new component, Sitecore doesn't know which placeholder you are adding it to.</p>\n<h2>The Solution</h2>\n<p>A solution to resolve this was to create an adapter in JavaScript, which does the following:</p>\n<ol>\n<li>Find all Sitecore placeholders and copy the <em>key</em> attribute to a new attribute, <em>data-phkey</em></li>\n<li>Execute the standard Vue.js app initialisation code.</li>\n<li>Copy the value from the new <em>data-phkey</em> attribute back to the <em>key</em>. attribute</li>\n</ol>\n<p>Here is the code to register the Vue.js app with the new adapter:</p>\n</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_sitecoreVueApdater<span class=\"token punctuation\">.</span><span class=\"token function\">InitialiseVueApp</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        el<span class=\"token operator\">:</span> <span class=\"token string\">\"#app\"</span><span class=\"token punctuation\">,</span>\n        store<span class=\"token punctuation\">,</span>\n        router<span class=\"token punctuation\">,</span>\n        components<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token operator\">...</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SitecoreModeService</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token function\">IsExperienceEditor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span><span class=\"token punctuation\">(</span>Sitecore<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"undefined\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>Sitecore <span class=\"token operator\">&amp;&amp;</span> Sitecore<span class=\"token punctuation\">.</span>PageModes <span class=\"token operator\">&amp;&amp;</span> Sitecore<span class=\"token punctuation\">.</span>PageModes<span class=\"token punctuation\">.</span>PageEditor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SitecoreVueApdater</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> _sitecoreModeService<span class=\"token operator\">:</span> SitecoreModeService<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> _keyAttributeName <span class=\"token operator\">=</span> <span class=\"token string\">\"key\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> _tempKeyAttributeName <span class=\"token operator\">=</span> <span class=\"token string\">\"data-phkey\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_sitecoreModeService <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SitecoreModeService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token function\">InitialiseVueApp</span><span class=\"token punctuation\">(</span>\n        <span class=\"token function-variable function\">initialiseVueApp</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span>\n    <span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">BuildSitecorePlaceholderMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">initialiseVueApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">EnsureSitecorePlaceholderKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token function\">BuildSitecorePlaceholderMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_sitecoreModeService<span class=\"token punctuation\">.</span><span class=\"token function\">IsExperienceEditor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> pagePlaceholders <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">code[</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_keyAttributeName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">]</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">CopyElementsAttribute</span><span class=\"token punctuation\">(</span>pagePlaceholders<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_keyAttributeName<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_tempKeyAttributeName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token function\">EnsureSitecorePlaceholderKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_sitecoreModeService<span class=\"token punctuation\">.</span><span class=\"token function\">IsExperienceEditor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> pagePlaceholders <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">code[</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_tempKeyAttributeName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">]</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">CopyElementsAttribute</span><span class=\"token punctuation\">(</span>pagePlaceholders<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_tempKeyAttributeName<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_keyAttributeName<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token function\">CopyElementsAttribute</span><span class=\"token punctuation\">(</span>\n        elements<span class=\"token operator\">:</span> NodeListOf<span class=\"token operator\">&lt;</span>Element<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n        fromAttributeName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n        toAttributeName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n        removeFromAttribute <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> placeholder <span class=\"token keyword\">of</span> elements<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            placeholder<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span>toAttributeName<span class=\"token punctuation\">,</span> placeholder<span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span>fromAttributeName<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>removeFromAttribute<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                placeholder<span class=\"token punctuation\">.</span><span class=\"token function\">removeAttribute</span><span class=\"token punctuation\">(</span>fromAttributeName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","timeToRead":2}},"pageContext":{"id":"361896ea-7c52-527b-b4fb-59eac49daf21"}},"staticQueryHashes":["1942088059"],"slicesMap":{}}