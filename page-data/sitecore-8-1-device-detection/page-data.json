{"componentChunkName":"component---src-templates-post-tsx","path":"/sitecore-8-1-device-detection/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Developers Guide to Sitecore 8.1 Device Detection","path":"/sitecore-8-1-device-detection","date":"March 09, 2016","dateIso":"2016-03-09T12:12:00.000Z","tags":["sitecore"],"references":["https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/set_up_device_detection|Sitecore Documentation - Set up Device Detection","https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/rules_and_parameters_for_device_detection|Sitecore Documentation - Device Detection Rules","https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/configure_sitecore_device_detection|Sitecore Documentation - Configuring Device Detection","https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/create_custom_rules_for_sitecore_device_detection|Sitecore Documentation - Creating Custom Rules","https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/api_reference_for_the_device_detection_service|Sitecore Documentation - Device Detection API","https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/using_device_detection|Sitecore Documentation - Using Device Detection"],"description":"Introduction to Device detection in Sitecore 8.1 and how to extend it"},"html":"<p>The release of Sitecore 8.1 includes new functionality for enabling device\ndetection. This post explains how developers can extend or customise the out\nof the box implementation.</p>\n<h2>Activating Device Detection</h2>\n<p>Sitecore has chosen <a href=\"http://www.netbiscuits.com/device-detection/\">Netbiscuits</a>\nas the provider for identifying devices and describing the capabilities they have. The\nservice requires a subscription through the <em>Sitecore App Center</em> which can be\nfound in the <em>Launch Pad</em> of Sitecore 8. In the UK, the monthly subscription\ncost is Â£119.21 for unlimited detections per month and until this is activated, the device\ndetection functionality described below is disabled.</p>\n<p>You can find more information for <a href=\"https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/set_up_device_detection\">setting up device detection on the Sitecore documentation site</a>.</p>\n<h2>Using Device Detection</h2>\n<p>You can read about <a href=\"https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/using_device_detection\">using Device Detection</a> on the Sitecore documentation site which goes through all of the integration points that are offered out of the box. The following points\ndescribe how this default functionality can be extended.</p>\n<h3>Creating a Custom Provider</h3>\n<p>If you already have device detection on your site using a different provider then you may\nwant to carry on using that provider. Sitecore documentation provides some useful developer information for\n<a href=\"https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/configure_sitecore_device_detection\">configuring device detection</a> and as with most Sitecore functionality, you can patch the default configuration to plug in your own provider. This means that you can get all of the above functionality but using a different implementation to the default Netbiscuits provider that ships with Sitecore 8.1. The configuration section which will need replacing is:</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>sitecore</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>deviceDetectionManager</span> <span class=\"token attr-name\">defaultProvider</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>netbiscuits<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">patch:</span>source</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Sitecore.CES.DeviceDetection.config<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>providers</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>clear</span><span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>add</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>netbiscuits<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Sitecore.CES.DeviceDetection.Netbiscuits.DeviceInformationProviderNetbiscuits, Sitecore.CES.DeviceDetection<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>providers</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>deviceDetectionManager</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>sitecore</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Using a custom include file to replace the default provider for your own implementation will\nprovide you full control of the device detection functionality within Sitecore 8.1, for example:</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>patch</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.sitecore.net/xmlconfig/<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>sitecore</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>deviceDetectionManager</span> <span class=\"token attr-name\">defaultProvider</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>netbiscuits<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">patch:</span>attribute</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>defaultProvider<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>newProviderName<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>providers</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>add</span> <span class=\"token attr-name\"><span class=\"token namespace\">patch:</span>instead</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>*[@name='netbiscuits']<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>newProviderName<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>YourNameSpace.CustomDeviceInformationProvider, YourAssembly<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>providers</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>deviceDetectionManager</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>sitecore</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>The Sitecore documentation for the <a href=\"https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/api_reference_for_the_device_detection_service\">device detection API</a>, along with the following skeleton class should be enough to get going with your own implementation of a device information provider:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomDeviceInformationProvider</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">Sitecore<span class=\"token punctuation\">.</span>CES<span class=\"token punctuation\">.</span>DeviceDetection<span class=\"token punctuation\">.</span>DeviceInformationProviderBase</span></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> <span class=\"token class-name\">ReaderWriterLockSlim</span> _readerWriterLockSlim <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ReaderWriterLockSlim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">bool</span></span> IsEnabled\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">get</span>\n        <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// TODO:Implement method to determine if functionality is enabled</span>\n\t\t\n          <span class=\"token keyword\">return</span> <span class=\"token function\">CustomLogicToDetermineIsEnabled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\t\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token return-type class-name\">DeviceInformation</span> <span class=\"token function\">GetDeviceInformation</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> userAgent<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        Assert<span class=\"token punctuation\">.</span><span class=\"token function\">ArgumentNotNull</span><span class=\"token punctuation\">(</span>userAgent<span class=\"token punctuation\">,</span> <span class=\"token string\">\"userAgent\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">base</span><span class=\"token punctuation\">.</span><span class=\"token function\">GetDeviceInformation</span><span class=\"token punctuation\">(</span>userAgent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">override</span> <span class=\"token return-type class-name\">DeviceInformation</span> <span class=\"token function\">DoGetDeviceInformation</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> userAgent<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        Assert<span class=\"token punctuation\">.</span><span class=\"token function\">ArgumentNotNull</span><span class=\"token punctuation\">(</span>userAgent<span class=\"token punctuation\">,</span> <span class=\"token string\">\"userAgent\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token keyword\">using</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ReadScope</span><span class=\"token punctuation\">(</span>_readerWriterLockSlim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// TODO: Implement functionality to fill in DeviceInformation from  supplier</span>\n\t\t\t\n            <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> deviceInformation <span class=\"token operator\">=</span> <span class=\"token function\">CustomLogicToGetDeviceInformation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            \n            <span class=\"token keyword\">return</span> deviceInformation<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Calling the base class's implementation of <em>GetDeviceInformation</em> ensures that\nthe result is cached within the Sitecore <em>DeviceItemsCache</em> and therefore only\n1 lookup is required per user agent (until the cache is cleared).</p>\n<h3>Sitecore Rules Engine Integration</h3>\n<p>One of the device detection integrations Sitecore provides is a set of rules for use with the Sitecore rules engine. The rules can be found under the item <code class=\"language-text\">/sitecore/system/Settings/Rules/Definitions/Elements/Device</code> and are described <a href=\"https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/rules_and_parameters_for_device_detection\">on the Sitecore Documentation site</a>. There is also a guide on how to <a href=\"https://doc.sitecore.net/sitecore_experience_platform/developing/device_detection/create_custom_rules_for_sitecore_device_detection\">create new custom rules</a>.</p>\n<h3>Sitecore Device Items &#x26; Device Detection</h3>\n<p>Another integration point for these rules are on the Sitecore device items found under\n<code class=\"language-text\">/sitecore/layout/Devices/Default</code>. A new field, <em>Rule</em>, has been added so that Sitecore will switch the user to that device item if the given rule evaluates to true. For example, <em>Mobile</em> Sitecore device item could use the rule <em><code class=\"language-text\">Device type is equal to Smartphone</code></em> to activate it.</p>\n<p>The rule configured on the Device Item is analysed within the <em>HttpRequestBegin</em>\npipeline step <em>Sitecore.Pipelines.HttpRequest.DeviceResolver</em>. This eventually calls\nthrough into the method <code class=\"language-text\">Sitecore.Data.Items.DeviceItem.MatchesRule(HttpContext httpContext)</code> to analyse the set rule against the visitor's request device. This shouldn't need to be\ncustomised, but if you find yourself needing to override the default <em>DeviceResolver</em>\nthen bear this functionality in mind.</p>\n<h3>xDB Integration</h3>\n<p>xDB also has an integration with Device Detection where reports can be generated showing a\nbreakdown of visitors by device type and then further filtered down to show a report by\ndevice model. You can see an <a href=\"https://doc.sitecore.net/~/media/446AB72ED1504A38B133E8EBD43D41A1.ashx?la=en\">example report</a> on the Sitecore documentation.</p>","timeToRead":3}},"pageContext":{"id":"54f17a27-cdd1-5aed-8dd6-7eaca6b71b94"}},"staticQueryHashes":["1942088059"],"slicesMap":{}}